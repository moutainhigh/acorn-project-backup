$(document).ready(function(){$("#loginUsers-grid").datagrid({width:"90%",height:"540",showHeader:true,nowrap:false,striped:true,border:true,collapsible:false,fitColumns:true,scrollbarSize:-1,url:"/getAU4",frozenColumns:[[]],columns:[[{field:"uid",title:"用户",width:60},{field:"ip",title:"登录IP",width:60},{field:"lastTime",title:"最近登录时间",width:60},{field:"server",title:"服务器",width:60},{field:"operator",title:"操作",width:50,align:"center",formatter:function(b,c,a){return"<a class='link kickOut mr10' title='登出' href=\"javascript:cullingUser('"+c.uid+"','"+c.server+"')\"></a><a class='link resetPw mr10' title='重置密码' href=\"javascript:changePwdShow('"+c.uid+"')\"></a><a class='link unlock' title='解锁' href=\"javascript:unlock('"+c.uid+"','"+c.server+"')\"></a>"}}]],remoteSort:false,singleSelect:false,checkOnSelect:false,selectOnCheck:false,pagination:true,pageSize:10,loadFilter:pagerFilter,queryParams:{uid:$("#uid").val(),service:$("#server").combobox("getValue"),ip:$("#ip").val()},onLoadSuccess:function(a){},onLoadError:function(){window.parent.alertWin("系统提示","加载用户Session信息失败!")}});$("#server").combobox({url:"/getAU3",valueField:"server",textField:"server"})});function cullingUser(a,c){var b=$(parent.document).find("#fn-bg");if(b){if(a!=b.html().trim().split("&")[0]){$.messager.confirm("系统提示",'<div style="padding:10px 0;">您确定要强制用户'+a+"登出?</div>",function(d){if(d){$.ajax({type:"get",url:"/cullingUserFromServer",data:{name:a,server:c},async:false,dataType:"json",success:function(){findInfo()}})}})}else{$.messager.alert("系统提示","不能强制自己登出！")}}}function changePwd(a){var c="12345678";var b='<div class="resetPW">确认要把用户['+a+"]的密码重置为:"+c;"</div>";if(a){$.messager.confirm("重置密码",b,function(d){if(d){$.ajax({type:"post",url:"/security/modifyPwd4Iagent",data:{userId:a,newPassword:c},async:false,dataType:"json",success:function(e){$.messager.alert("系统提示",e.msg)}})}})}}function changePwd2(){var a=$("#cullingUserId").val();var c="12345678";var b='<div class="resetPW">确认要把用户['+a+"]的密码重置为:"+c;"</div>";if(a){$.messager.confirm("重置密码",b,function(d){if(d){$.ajax({type:"post",url:"/security/modifyPwd4Iagent",data:{userId:a,newPassword:c},async:false,dataType:"json",success:function(e){$.messager.alert("系统提示",e.msg)}})}})}else{$.messager.alert("系统提示","请输入用户Id")}}function changePwdShow(b){if(b==2){var a=$("#cullingUserId").val();if(a){$("#viewUserId").val(a);$("#resetWin").window("open")}else{$.messager.alert("系统提示","请输入用户Id")}}else{a=b;if(a){$("#viewUserId").val(a);$("#resetWin").window("open")}}}function submitChangePwd(){if($("#modifyPWForm").form("validate")){$.ajax({type:"post",url:"/security/modifyPwd4Iagent",data:{userId:$("#viewUserId").val(),newPassword:$("#password2").val()},async:false,dataType:"json",success:function(a){$("#resetWin").window("close");$.messager.alert("系统提示",a.msg)}})}}function clearChangePwd(){$("#viewUserId").val("");$("#password1").val("");$("#password2").val("");$("#resetWin").window("close")}function unlock(a){if(a){$.ajax({type:"get",url:"/security/releaseLock",data:{userId:a},async:false,dataType:"json",success:function(b){$.messager.alert("系统提示",b.msg)}})}}function unlock2(){var a=$("#cullingUserId").val();if(a){$.ajax({type:"get",url:"/security/releaseLock",data:{userId:a},async:false,dataType:"json",success:function(b){$.messager.alert("系统提示",b.msg)}})}else{$.messager.alert("系统提示","请输入用户Id")}}function pagerFilter(d){if(typeof d.length=="number"&&typeof d.splice=="function"){d={total:d.length,rows:d}}var e=$(this);var c=e.datagrid("options");var b=e.datagrid("getPager");b.pagination({onSelectPage:function(h,g){c.pageNumber=h;c.pageSize=g;b.pagination("refresh",{pageNumber:h,pageSize:g});e.datagrid("loadData",d)}});if(!d.originalRows){d.originalRows=(d.rows)}var f=(c.pageNumber-1)*parseInt(c.pageSize);var a=f+parseInt(c.pageSize);d.rows=(d.originalRows.slice(f,a));return d}function cullingSingleUser(){var a=$(parent.document).find("#fn-bg");var b=$("#cullingUserId").val();if(b==""){$.messager.alert("系统提示","用户Id不能为空！");return false}if(b!=a.html().trim().split("&")[0]){$.messager.confirm("系统提示","您确定要强制用户"+b+"登出?",function(c){if(c){$.ajax({type:"get",url:"/cullingUserAll",data:"name="+b,async:false,dataType:"json",success:function(d){if(typeof(d)=="undefined"){$.messager.alert("系统提示","强制退出失败！")}else{$("#cullingUserId").val("");$.messager.alert("系统提示","强制退出成功！")}findInfo()}})}})}else{$.messager.alert("系统提示","不能强制自己登出！")}}function findInfo(){$("#loginUsers-grid").datagrid("load",{uid:$("#uid").val(),service:$("#server").combobox("getValue"),ip:$("#ip").val()})};