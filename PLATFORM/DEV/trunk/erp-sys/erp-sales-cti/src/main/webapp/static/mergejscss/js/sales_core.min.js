if($.fn.pagination){$.fn.pagination.defaults.beforePageText="第";$.fn.pagination.defaults.afterPageText="共{pages}页";$.fn.pagination.defaults.displayMsg="显示{from}到{to},共{total}记录"}if($.fn.datagrid){$.fn.datagrid.defaults.loadMsg="正在处理，请稍待。。。"}if($.fn.treegrid&&$.fn.datagrid){$.fn.treegrid.defaults.loadMsg=$.fn.datagrid.defaults.loadMsg}if($.messager){$.messager.defaults.ok="确定";$.messager.defaults.cancel="取消"}if($.fn.validatebox){$.fn.validatebox.defaults.missingMessage="该输入项为必输项";$.fn.validatebox.defaults.rules.email.message="请输入有效的电子邮件地址";$.fn.validatebox.defaults.rules.url.message="请输入有效的URL地址";$.fn.validatebox.defaults.rules.length.message="输入内容长度必须介于{0}和{1}之间";$.fn.validatebox.defaults.rules.remote.message="请修正该字段"}if($.fn.numberbox){$.fn.numberbox.defaults.missingMessage="该输入项为必输项"}if($.fn.combobox){$.fn.combobox.defaults.missingMessage="该输入项为必输项"}if($.fn.combotree){$.fn.combotree.defaults.missingMessage="该输入项为必输项"}if($.fn.combogrid){$.fn.combogrid.defaults.missingMessage="该输入项为必输项"}if($.fn.calendar){$.fn.calendar.defaults.weeks=["日","一","二","三","四","五","六"];$.fn.calendar.defaults.months=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}if($.fn.datebox){$.fn.datebox.defaults.currentText="今天";$.fn.datebox.defaults.closeText="关闭";$.fn.datebox.defaults.okText="确定";$.fn.datebox.defaults.missingMessage="该输入项为必输项";$.fn.datebox.defaults.formatter=function(b){var e=b.getFullYear();var a=b.getMonth()+1;var c=b.getDate();return e+"-"+(a<10?("0"+a):a)+"-"+(c<10?("0"+c):c)};$.fn.datebox.defaults.parser=function(c){if(!c){return new Date()}var b=c.split("-");var f=parseInt(b[0],10);var a=parseInt(b[1],10);var e=parseInt(b[2],10);if(!isNaN(f)&&!isNaN(a)&&!isNaN(e)){return new Date(f,a-1,e)}else{return new Date()}}}if($.fn.datetimebox&&$.fn.datebox){$.extend($.fn.datetimebox.defaults,{currentText:$.fn.datebox.defaults.currentText,closeText:$.fn.datebox.defaults.closeText,okText:$.fn.datebox.defaults.okText,missingMessage:$.fn.datebox.defaults.missingMessage})}$.extend($.fn.validatebox.defaults.rules,{mobile:{validator:function(a){return/^(13|14|15|18)\d{9}$/i.test(a)},message:"手机号码格式不正确"},telephoneAreaCode:{validator:function(a){return/^(\d{4}|\d{3})$/i.test(a)},message:"区号格式不正确"},telephone:{validator:function(a){return/^(\d{7,8})$/i.test(a)},message:"电话号码格式不正确"},telephoneExt:{validator:function(a){return/^(\d{4}|\d{3}|\d{2}|\d{1})$/i.test(a)},message:"分机号格式不正确"},zipCode:{validator:function(a){return/^[0-9][0-9]{5}$/i.test(a)},message:"邮政编码格式不正确"},address_p:{validator:function(b,c){var a=false;$.each($(c[0]).combobox("getData"),function(d,e){if(e.provinceName==b){a=true}});return a},message:"地址无效"},address_c:{validator:function(b,c){var a=false;$.each($(c[0]).combobox("getData"),function(d,e){if(e.cityName==b){a=true}});return a},message:"地址无效"},address_t:{validator:function(b,c){var a=false;$.each($(c[0]).combobox("getData"),function(d,e){if(e.countyName==b){a=true}});return a},message:"地址无效"},address_a:{validator:function(b,c){var a=false;$.each($(c[0]).combobox("getData"),function(d,e){if(e.areaName==b){a=true}});return a},message:"地址无效"},istoday:{validator:function(d,f){console.info("===="+f[0]);if(!f[0]){console.info("====7"+f[0]);return true}var e=Date.parse(d.replace(/-/g,"/"));console.info("====date1:"+e);var b=new Date();var a=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" 23:59:59";console.info("====date2Str:"+a);var c=Date.parse(a.replace(/-/g,"/"));console.info("====date2:"+c);console.info("====date2:"+(e<c));console.info("====date2:"+(b<e));if(b<e){if(e<c){return true}else{return false;console.info("====date3:"+11)}}else{console.info("====date4:"+11);return false}},message:"时间格式不正确(只能选择当天)"},equals:{validator:function(a,b){return a==$(b[0]).val()},message:"两次密码输入不一致。"}});
/*!
 * Marquee jQuery Plug-in
 *
 * Copyright 2009 Giva, Inc. (http://www.givainc.com/labs/) 
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * 	http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Date: 2009-05-20
 * Rev:  1.0.01
 */
(function(a){a.marquee={version:"1.0.01"};a.fn.marquee=function(e){var f=typeof arguments[0]=="string"&&arguments[0];var d=f&&Array.prototype.slice.call(arguments,1)||arguments;var c=(this.length==0)?null:a.data(this[0],"marquee");if(c&&f&&this.length){if(f.toLowerCase()=="object"){return c}else{if(c[f]){var b;this.each(function(g){var h=a.data(this,"marquee")[f].apply(c,d);if(g==0&&h){if(!!h.jquery){b=a([]).add(h)}else{b=h;return false}}else{if(!!h&&!!h.jquery){b=b.add(h)}}});return b||this}else{return this}}}else{return this.each(function(){new a.Marquee(this,e)})}};a.Marquee=function(e,r){r=a.extend({},a.Marquee.defaults,r);var p=this,n=a(e),f=n.find("> li"),h=-1,g=false,m=false,o=0;a.data(n[0],"marquee",p);this.pause=function(){g=true;q()};this.resume=function(){g=false;d()};this.update=function(){var s=f.length;f=n.find("> li");if(s<=1){d()}};function l(s){if(f.filter("."+r.cssShowing).length>0){return false}var u=f.eq(s);if(a.isFunction(r.beforeshow)){r.beforeshow.apply(p,[n,u])}var t={top:(r.yScroll=="top"?"-":"+")+u.outerHeight()+"px",left:0};n.data("marquee.showing",true);u.addClass(r.cssShowing);u.css(t).animate({top:"0px"},r.showSpeed,r.fxEasingShow,function(){if(a.isFunction(r.show)){r.show.apply(p,[n,u])}n.data("marquee.showing",false);k(u)})}function k(t,s){if(m==true){return false}s=s||r.pauseSpeed;if(c(t)){setTimeout(function(){if(m==true){return false}var w=t.outerWidth(),u=w*-1,v=parseInt(t.css("left"),10);t.animate({left:u+"px"},((w+v)*r.scrollSpeed),r.fxEasingScroll,function(){j(t)})},s)}else{if(f.length>1){setTimeout(function(){if(m==true){return false}t.animate({top:(r.yScroll=="top"?"+":"-")+n.innerHeight()+"px"},r.showSpeed,r.fxEasingScroll);j(t)},s)}}}function j(s){if(a.isFunction(r.aftershow)){r.aftershow.apply(p,[n,s])}s.removeClass(r.cssShowing);b()}function q(){m=true;if(n.data("marquee.showing")!=true){f.filter("."+r.cssShowing).dequeue().stop()}}function d(){m=false;if(n.data("marquee.showing")!=true){k(f.filter("."+r.cssShowing),1)}}if(r.pauseOnHover){n.hover(function(){if(g){return false}q()},function(){if(g){return false}d()})}function c(s){return(s.outerWidth()>n.innerWidth())}function b(){h++;if(h>=f.length){if(!isNaN(r.loop)&&r.loop>0&&(++o>=r.loop)){return false}h=0}l(h)}if(a.isFunction(r.init)){r.init.apply(p,[n,r])}b()};a.Marquee.defaults={yScroll:"top",showSpeed:850,scrollSpeed:12,pauseSpeed:5000,pauseOnHover:true,loop:-1,fxEasingShow:"swing",fxEasingScroll:"linear",cssShowing:"marquee-showing",init:null,beforeshow:null,show:null,aftershow:null}})(jQuery);(function(a){a.fn.extend({autocomplete:function(b,c){var d=typeof b=="string";c=a.extend({},a.Autocompleter.defaults,{url:d?b:null,data:d?null:b,delay:d?a.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(e){return e};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c)})},result:function(b){return this.bind("result",b)},search:function(b){return this.trigger("search",[b])},scrollSearch:function(b){return this.trigger("scrollSearch")},flushCache:function(){return this.trigger("flushCache")},setOptions:function(b){return this.trigger("setOptions",[b])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(m,g){var c={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var b=a(m).attr("autocomplete","off").addClass(g.inputClass);var k;var q="";var n=a.Autocompleter.Cache(g);var e=0;var v;var y={mouseDownOnSelect:false};var s=a.Autocompleter.Select(g,m,d,y,n);var x;a.browser.opera&&a(m.form).bind("submit.autocomplete",function(){if(x){x=false;return false}});b.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(z){e=1;v=z.keyCode;switch(z.keyCode){case c.UP:z.preventDefault();if(s.visible()){s.prev()}else{u(0,true)}break;case c.DOWN:z.preventDefault();if(s.visible()){s.next()}else{u(0,true)}break;case c.PAGEUP:z.preventDefault();if(s.visible()){s.pageUp()}else{u(0,true)}break;case c.PAGEDOWN:z.preventDefault();if(s.visible()){s.pageDown()}else{u(0,true)}break;case g.multiple&&a.trim(g.multipleSeparator)==","&&c.COMMA:case c.TAB:case c.RETURN:if(d()){z.preventDefault();x=true;return false}break;case c.ESC:s.hide();break;default:clearTimeout(k);k=setTimeout(u,g.delay);break}}).focus(function(){e++}).blur(function(){e=0;if(!y.mouseDownOnSelect){t()}}).click(function(){if(e++>1&&!s.visible()){u(0,true)}}).bind("scrollSearch",function(){var z=j(b.val());if(z.length>=g.minChars){b.addClass(g.loadingClass);if(!g.matchCase){z=z.toLowerCase()}g.scrolling=true;g.scrollIndex++;e++;f(z,l,w)}else{e=0;o();s.hide()}}).bind("search",function(){var z=(arguments.length>1)?arguments[1]:null;function A(E,D){var B;if(D&&D.length){for(var C=0;C<D.length;C++){if(D[C].result.toLowerCase()==E.toLowerCase()){B=D[C];break}}}if(typeof z=="function"){z(B)}else{b.trigger("result",B&&[B.data,B.value])}}a.each(h(b.val()),function(B,C){f(C,A,A)})}).bind("flushCache",function(){n.flush()}).bind("setOptions",function(){a.extend(g,arguments[1]);if("data" in arguments[1]){n.populate()}}).bind("unautocomplete",function(){s.unbind();b.unbind();a(m.form).unbind(".autocomplete")});function d(){var C=s.selected();if(!C){return false}var z=C.result;q=z;if(g.multiple){var F=h(b.val());if(F.length>1){var B=g.multipleSeparator.length;var E=a(m).selection().start;var D,A=0;a.each(F,function(G,H){A+=H.length;if(E<=A){D=G;return false}A+=B});F[D]=z;z=F.join(g.multipleSeparator)}z+=g.multipleSeparator}b.val(z);w();b.trigger("result",[C.data,C.value]);return true}function u(B,A){if(v==c.DEL){s.hide();return}var z=b.val();if(!A&&z==q){return}q=z;z=j(z);if(z.length>=g.minChars){b.addClass(g.loadingClass);if(!g.matchCase){z=z.toLowerCase()}g.scrolling=false;g.scrollIndex=0;f(z,l,w)}else{o();s.hide()}}function h(z){if(!z){return[""]}if(!g.multiple){return[a.trim(z)]}return a.map(z.split(g.multipleSeparator),function(A){return a.trim(z).length?a.trim(A):null})}function j(z){if(!g.multiple){return z}var B=h(z);if(B.length==1){return B[0]}var A=a(m).selection().start;if(A==z.length){B=h(z)}else{B=h(z.replace(z.substring(A),""))}return B[B.length-1]}function r(z,A){if(g.autoFill&&(j(b.val()).toLowerCase()==z.toLowerCase())&&v!=c.BACKSPACE){b.val(b.val()+A.substring(j(q).length));a(m).selection(q.length,q.length+A.length)}}function t(){clearTimeout(k);k=setTimeout(w,200)}function w(){var z=s.visible();s.hide();clearTimeout(k);o();if(g.mustMatch){b.search(function(A){if(!A){if(g.multiple){var B=h(b.val()).slice(0,-1);b.val(B.join(g.multipleSeparator)+(B.length?g.multipleSeparator:""))}else{b.val("");b.trigger("result",null)}}})}}function l(A,z){if(z&&z.length&&e){o();s.display(z,A);r(A,z[0].value);s.show()}else{w()}}function f(A,C,z){if(!g.matchCase){A=A.toLowerCase()}var B=n.load(A+"_"+g.scrollIndex);if(B&&B.length){C(A,B);g.scrolling=false}else{if((typeof g.url=="string")&&(g.url.length>0)){if(g.scrollIndex>0){B=n.load(A+"_"+(g.scrollIndex-1));if(B&&B.length<g.max){g.scrollIndex--;g.scrolling=false;return}}var D={timestamp:+new Date()};a.each(g.extraParams,function(E,F){D[E]=typeof F=="function"?F():F});a.ajax({mode:"abort",port:"autocomplete"+m.name,dataType:g.dataType,url:g.url,data:a.extend({q:j(A),index:g.scrollIndex,limit:g.max},D),success:function(F){var E=g.parse&&g.parse(F)||p(F);n.add(A+"_"+g.scrollIndex,E);if(E&&E.length){C(A,E)}else{C(A,null)}},complete:function(){g.scrolling=false}})}else{s.emptyList();z(A);g.scrolling=false}}}function p(C){var z=[];var B=C.split("\n");for(var A=0;A<B.length;A++){var D=a.trim(B[A]);if(D){D=D.split("|");z[z.length]={data:D,value:D[0],result:g.formatResult&&g.formatResult(D,D[0])||D[0]}}}return z}function o(){b.removeClass(g.loadingClass)}};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(b){return b[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180,scrollAfterHeight:90,scrollIndex:0,scrolling:false};a.Autocompleter.Cache=function(c){var f={};var d=0;function h(l,k){if(!c.matchCase){l=l.toLowerCase()}var j=l.indexOf(k);if(c.matchContains=="word"){j=l.toLowerCase().search("\\b"+k.toLowerCase())}if(j==-1){return false}return j==0||c.matchContains}function g(k,j){if(d>c.cacheLength){b()}if(!f[k]){d++}f[k]=j}function e(){if(!c.data){return false}var k={},j=0;if(!c.url){c.cacheLength=1}k[""]=[];for(var m=0,l=c.data.length;m<l;m++){var p=c.data[m];p=(typeof p=="string")?[p]:p;var o=c.formatMatch(p,m+1,c.data.length);if(o===false){continue}var n=o.charAt(0).toLowerCase();if(!k[n]){k[n]=[]}var q={value:o,data:p,result:c.formatResult&&c.formatResult(p)||o};k[n].push(q);if(j++<c.max){k[""].push(q)}}a.each(k,function(r,s){c.cacheLength++;g(r,s)})}setTimeout(e,25);function b(){f={};d=0}return{flush:b,add:g,populate:e,load:function(n){if(!c.cacheLength||!d){return null}if(!c.url&&c.matchContains){var m=[];for(var j in f){if(j.length>0){var o=f[j];a.each(o,function(p,k){if(h(k.value,n)){m.push(k)}})}}return m}else{if(f[n]){return f[n]}else{if(c.matchSubset){for(var l=n.length-1;l>=c.minChars;l--){var o=f[n.substr(0,l)];if(o){var m=[];a.each(o,function(p,k){if(h(k.value,n)){m[m.length]=k}});return m}}}}}return null}}};a.Autocompleter.Select=function(e,k,n,r,m){var j={ACTIVE:"ac_over"};var l,f=-1,t,o="",u=true,c,q;function p(){if(!u){return}c=a("<div/>").hide().addClass(e.resultsClass).css("position","absolute").appendTo(document.body);q=a("<ul/>").appendTo(c).mouseover(function(v){if(s(v).nodeName&&s(v).nodeName.toUpperCase()=="LI"){f=a("li",q).removeClass(j.ACTIVE).index(s(v));a(s(v)).addClass(j.ACTIVE)}}).click(function(v){a(s(v)).addClass(j.ACTIVE);n();k.focus();return false}).mousedown(function(){r.mouseDownOnSelect=true}).mouseup(function(){r.mouseDownOnSelect=false});if(e.width>0){c.css("width",e.width)}a(q).bind("scroll",function(v){if(e.scrolling){return}if(Math.round(this.scrollTop/(this.scrollHeight-this.clientHeight)*100)>e.scrollAfterHeight){a(k).scrollSearch()}});u=false}function s(w){var v=w.target;while(v&&v.tagName!="LI"){v=v.parentNode}if(!v){return[]}return v}function h(v){l.slice(f,f+1).removeClass(j.ACTIVE);g(v);var x=l.slice(f,f+1).addClass(j.ACTIVE);if(e.scroll){var w=0;l.slice(0,f).each(function(){w+=this.offsetHeight});if((w+x[0].offsetHeight-q.scrollTop())>q[0].clientHeight){q.scrollTop(w+x[0].offsetHeight-q.innerHeight())}else{if(w<q.scrollTop()){q.scrollTop(w)}}}}function g(v){f+=v;if(f<0){f=l.size()-1}else{if(f>=l.size()){f=0}}}function b(v){return e.max&&e.max<v?e.max:v}function d(){if(!e.scrolling){q.empty()}var w=b(t.length);for(var x=0;x<w;x++){if(!t[x]){continue}var y=e.formatItem(t[x].data,x+1,w,t[x].value,o);if(y===false){continue}var v=a("<li/>").html(e.highlight(y,o)).addClass(x%2==0?"ac_even":"ac_odd").appendTo(q)[0];a.data(v,"ac_data",t[x])}l=q.find("li");if(e.scrolling){l.slice(e.max*e.scrollIndex,1).addClass(j.ACTIVE);f=e.max*e.scrollIndex}else{if(e.selectFirst){l.slice(0,1).addClass(j.ACTIVE);f=0}}if(a.fn.bgiframe){q.bgiframe()}}return{display:function(w,v){p();t=w;o=v;d()},next:function(){h(1)},prev:function(){h(-1)},pageUp:function(){if(f!=0&&f-8<0){h(-f)}else{h(-8)}},pageDown:function(){if(f!=l.size()-1&&f+8>l.size()){h(l.size()-1-f)}else{h(8)}},hide:function(){c&&c.hide();l&&l.removeClass(j.ACTIVE);f=-1},visible:function(){return c&&c.is(":visible")},current:function(){return this.visible()&&(l.filter("."+j.ACTIVE)[0]||e.selectFirst&&l[0])},show:function(){var x=a(k).offset();(function(){c.css({width:typeof e.width=="string"||e.width>0?e.width:a(k).width(),top:a(k).offset().top+k.offsetHeight,left:a(k).offset().left});setTimeout(arguments.callee,200)})();c.show();if(e.scroll){q.scrollTop(0);q.css({maxHeight:e.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var v=0;l.each(function(){v+=this.offsetHeight});var w=v>e.scrollHeight;q.css("height",w?e.scrollHeight:v);if(!w){l.width(q.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right")))}}}},selected:function(){var v=l&&l.filter("."+j.ACTIVE).removeClass(j.ACTIVE);return v&&v.length&&a.data(v[0],"ac_data")},emptyList:function(){q&&q.empty()},unbind:function(){c&&c.remove()}}};a.fn.selection=function(j,b){if(j!==undefined){return this.each(function(){if(this.createTextRange){var k=this.createTextRange();if(b===undefined||j==b){k.move("character",j);k.select()}else{k.collapse(true);k.moveStart("character",j);k.moveEnd("character",b);k.select()}}else{if(this.setSelectionRange){this.setSelectionRange(j,b)}else{if(this.selectionStart){this.selectionStart=j;this.selectionEnd=b}}}})}var g=this[0];if(g.createTextRange){var c=document.selection.createRange(),h=g.value,f="<->",d=c.text.length;c.text=f;var e=g.value.indexOf(f);g.value=h;this.selection(e,e+d);return{start:e,end:e+d}}else{if(g.selectionStart!==undefined){return{start:g.selectionStart,end:g.selectionEnd}}}}})(jQuery);(function(c){var d={groupColumn:1,sumColumn:0,useNumChars:0,groupClass:""};var b=function(h,f,e){for(var g=0;g<f.length;g++){if(f[g].realIndex===undefined){a(h)}if(f[g].realIndex==e){return f[g]}}return null};var a=function(x){var z=x.rows;var q=z.length;var w=[];var u=0;for(var o=0;o<q;o++){var y=z[o].cells;var v=y.length;u=Math.max(v,u);for(var n=0;n<v;n++){var t=y[n];var s=t.rowSpan||1;var p=t.colSpan||1;var r=-1;if(!w[o]){w[o]=[]}var f=w[o];while(f[++r]){}t.realIndex=r;for(var h=o;h<o+s;h++){if(!w[h]){w[h]=[]}var e=w[h];for(var g=r;g<r+p;g++){e[g]=1}}}}x.numCols=u};c.fn.tableGroup=function(e){var f=c.extend({},d,e);return this.each(function(){var j,r,h,n,y,o,l,p,v,m,x,k;h=f.groupColumn-1;l="";x=[];if(!this.tBodies||!this.tBodies.length){return}v="tGroup "+f.groupClass;for(j=0;j<this.tBodies.length;j++){n=this.tBodies[j];for(r=0;r<n.rows.length;r++){y=n.rows[r];p=b(this,y.cells,h);if(p){if(f.useNumChars==0){m=p.innerHTML}else{k=p.textContent||p.innerText;m=k.substr(0,f.useNumChars)}if(m!=l){o=c('<tr class="'+v+'" accessKey="'+(p.textContent||p.innerText)+'"><td colspan="'+this.numCols+'">'+m+"</td></tr>");o.find("td")[0].realIndex=0;c(y).before(o);l=m;x.push(o)}else{c(y).attr("match",p.textContent||p.innerText)}}}var w;var g=f.sumColumn-1;if(g>0){while(x.length>0){o=x.pop();if(o){var t=o.attr("accessKey");if(t){var q=0;var u=c(this);u.find("tr[match='"+t+"']").each(function(){w=b(u.get(),this.cells,g);if(w){var s=c(w).text();if(!isNaN(s)){q+=parseFloat(s)}}});o.find("td > div").append("&nbsp;&nbsp;数量："+q)}}}}}})};c.fn.tableUnGroup=function(){return this.each(function(){c("tr.tGroup",this).remove()})}})(jQuery);(function(b){var a=function(d){var c=0;d(c,{second:"00",minute:"00"});a.instance=this;this.timer=function(){if(typeof(d)=="function"){var e={total:c,second:Math.floor(c%60).toString().length<2?"0"+Math.floor(c%60):Math.floor(c%60),minute:Math.floor((c/60)%60).toString().length<2?"0"+Math.floor((c/60)%60):Math.floor((c/60)%60),hour:Math.floor((c/3600)%24).toString().length<2?"0"+Math.floor((c/3600)%24):Math.floor((c/3600)%24),day:Math.floor(c/86400)};d(c,e)}if(phone){phone.seconds=c}c++};this.id=window.setInterval(this.timer,1000);this.stop=function(){clearInterval(this.id);a.instance=undefined;return c-1};this.reset=function(){this.stop();a.instance=undefined}};b.countup=function(d){var c;if(typeof a.instance=="undefined"){c=new a(d)}else{return}return c}})(jQuery);Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};var printLog=function(a){console.log(new Date().format("MM-dd hh:mm:ss.S")+" >>>>>> "+a)};if(!this.JSON){this.JSON={}}(function(){function k(a){return a<10?"0"+a:a}function n(a){o.lastIndex=0;return o.test(a)?'"'+a.replace(o,function(c){var d=q[c];return typeof d==="string"?d:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function l(a,c){var d,f,i=g,e,b=c[a];if(b&&typeof b==="object"&&typeof b.toJSON==="function"){b=b.toJSON(a)}if(typeof j==="function"){b=j.call(c,a,b)}switch(typeof b){case"string":return n(b);case"number":return isFinite(b)?String(b):"null";case"boolean":case"null":return String(b);case"object":if(!b){return"null"}g+=m;e=[];if(Object.prototype.toString.apply(b)==="[object Array]"){f=b.length;for(a=0;a<f;a+=1){e[a]=l(a,b)||"null"}c=e.length===0?"[]":g?"[\n"+g+e.join(",\n"+g)+"\n"+i+"]":"["+e.join(",")+"]";g=i;return c}if(j&&typeof j==="object"){f=j.length;for(a=0;a<f;a+=1){d=j[a];if(typeof d==="string"){if(c=l(d,b)){e.push(n(d)+(g?": ":":")+c)}}}}else{for(d in b){if(Object.hasOwnProperty.call(b,d)){if(c=l(d,b)){e.push(n(d)+(g?": ":":")+c)}}}}c=e.length===0?"{}":g?"{\n"+g+e.join(",\n"+g)+"\n"+i+"}":"{"+e.join(",")+"}";g=i;return c}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var p=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,m,q={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;if(typeof JSON.stringify!=="function"){JSON.stringify=function(a,c,d){var f;m=g="";if(typeof d==="number"){for(f=0;f<d;f+=1){m+=" "}}else{if(typeof d==="string"){m=d}}if((j=c)&&typeof c!=="function"&&(typeof c!=="object"||typeof c.length!=="number")){throw new Error("JSON.stringify")}return l("",{"":a})}}if(typeof JSON.parse!=="function"){JSON.parse=function(a,c){function d(f,i){var e,b,h=f[i];if(h&&typeof h==="object"){for(e in h){if(Object.hasOwnProperty.call(h,e)){b=d(h,e);if(b!==undefined){h[e]=b}else{delete h[e]}}}}return c.call(f,i,h)}p.lastIndex=0;if(p.test(a)){a=a.replace(p,function(f){return"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){a=eval("("+a+")");return typeof c==="function"?d({"":a},""):a}throw new SyntaxError("JSON.parse")}}})();$.fn.serializeObject=function(){var c={};var b=this.serializeArray();$.each(b,function(){if(c[this.name]){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}});return c};$.postJSON=function(a,b,c){return jQuery.ajax({type:"POST",url:a,contentType:"application/json",data:JSON.stringify(b),dataType:"json",success:c})};function AcornPhone(b,a,c,d){this.ani=b;this.dnsi=a;this.tollFreeNum=c;this.isOutBoound=d;this.boundType=0;this.status=0;this.company="";this.province="";this.instId="";this.seconds="";this.customerType="";this.customerId="";this.currentLeadId="";this.cticonnid="";this.connStates="";this.task=new Array();this.ctisdt="";this.ctiedt="";this.leavingReason="";this.insure="";this._expir=300;this.campainId="";this.acdId="";this.onOffHook=null;this.onReady=null;this.onReadyOut=null;this.onLeaving=null;this.onRinging=null;this.onTalking=null;this.onDialing=null;this.onTalkingOut=null;this.onProcessing=null;this.onTransfering=null;this.onMeeting=null;this.onLogout=null;this.onTriTalking=null;this.onHolding=null;this.onOutringing=null;this.onOutcall=null;this.offline=null;this.ReadyOut=null}AcornPhone.prototype.statusTable=[[2,3,5,10],[0,2,5],[0,5,10],[4],[7],[6,7],[7],[0,1,2],[-1,2],[],[],[],[]];AcornPhone.prototype.statusNams=["摘机","就绪","就绪-可外呼","离席","振铃","通话中","呼出中","呼出通话","后处理","转接中","会议","注销","三方通话","保持"];AcornPhone.prototype.getValidStatus=function getValidStatus(){return(this.statusTable[this.status])};AcornPhone.prototype.getStatusName=function(a){if(a==null||a==undefined){return(this.statusNams[this.status])}else{if(a>=-1&&a<=15){return(this.statusNams[a])}else{return null}}};AcornPhone.prototype.init=function(){if(this.offline!=null){this.status=15;this.offline(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound)}};AcornPhone.prototype.onStatusChange=function(){if(this.ani){var a=this.ani.substr(0,this.ani.length-4)+"****"}switch(this.status){case -1:if(this.onOffHook!=null){this.onOffHook(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 0:if(this.onReady!=null){if(checkSoftPhoneApplet()){if($("#ctiPhoneType").val()==1){if(!getDnStatus(null)){console.info("========"+getDnStatus(null));changeCtiOnAndOff_off();msgSlide("电话没有挂机，请挂机！！");return;break}else{this.onReady(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}}else{this.onReady(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}}else{this.onReady(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}}break;case 1:if(this.onReadyOut!=null){this.onReadyOut(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 2:if(this.onLeaving!=null){this.onLeaving(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 3:if(this.onRinging!=null){this.onRinging(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 4:if(this.onTalking!=null){this.onTalking(a,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 5:if(this.onDialing!=null){this.onDialing(a,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 6:if(this.onTalkingOut!=null){this.onTalkingOut(a,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 7:if(this.onProcessing!=null){this.onProcessing(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 8:if(this.onTransfering!=null){this.onTransfering(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound)}break;case 9:if(this.onMeeting!=null){this.onMeeting(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound)}break;case 10:if(this.onLogout!=null){this.onLogout(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound)}break;case 11:if(this.onTriTalking!=null){this.onTriTalking(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound)}break;case 12:if(this.onHolding!=null){this.onHolding(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 13:if(this.onOutringing!=null){this.onOutringing(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 14:if(this.onOutcall!=null){this.onOutcall(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;case 15:if(this.offline!=null){this.offline(this.ani,this.dnsi,this.tollFreeNum,this.isOutBoound,this.company,this.province)}break;default:}};AcornPhone.prototype.changeStatus=function(c,b,a,e,g){var f=true;if(c>=-1&&c<=15){var d=this.getValidStatus();this.status=c;if(b!=null){this.ani=b}if(a!=null){this.dnsi=b}if(g!=null){this.isOutBoound=g}if(e!=null){this.tollFreeNum=e}this.onStatusChange()}else{f=false}if(f==false){throw new Error("invalid status change from "+this.status+" to "+c)}};AcornPhone.prototype.setCurrentLeadId=function(a){this.currentLeadId=a};AcornPhone.prototype.getCurrentLeadId=function(a){return this.currentLeadId};AcornPhone.prototype.clearCurrentLeadId=function(){this.currentLeadId="";this.task=new Array()};AcornPhone.prototype.addTask=function(a){return this.task.push(a)};AcornPhone.prototype.deleteTask=function(b){var a="";for(i=0;i<this.task.length;i++){if(this.task[i]==b){a=arrayObj.splice(i,1)}}return a};AcornPhone.prototype.clean=function(){this.ani=null;this.dnsi=null;this.tollFreeNum=null;this.isOutBoound=null;this.status=0;this.customerType="";this.customerId="";this.company="";this.province="";this.instId="";this.boundType=0;this.seconds="";this.currentLeadId="";this.cticonnid="";this.task=new Array();this.connStates="";this.ctisdt="";this.ctiedt="";this.insure="";this.campainId="";this.acdId=""};var notReadyState=0;var mediaType="voice";var ctiIsLogIn=0;var isDial=0;var isInitiate=0;function checkSoftPhoneApplet(){if(typeof(SoftPhone)!="undefined"){return true}return false}function callAnswer(){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.answer(1,null);if(a==1){return true}return false}function login(){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.login(mediaType);if(a==1){return true}return false}function agentLogout(){if(!checkSoftPhoneApplet()){return false}try{var a=SoftPhone.logout(mediaType);if(a==1){return true}}catch(b){}return false}function ready(){if(!checkSoftPhoneApplet()){return false}if(!getDnStatus(null)){return false}var a=SoftPhone.ready(mediaType);if(a==1){if(phone){phone.changeStatus(0)}return true}return false}function release(){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.release(1,"{params:{Reasons:{agentHangUp:'1'}}}");if(a==1){return true}return false}function releaseLine2(){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.release(2,null);if(a==1){return true}return false}function singleStepTransfer(b){if(!checkSoftPhoneApplet()){return false}console.info("单步转接....");var a=SoftPhone.singleStepTransfer(1,b,null);if(a==1){return true}return false}function initiateTransfer(b){isInitiate=1;if(!checkSoftPhoneApplet()){return false}var c="{'params' : {'UserData':{command:'2', 'ani' : "+phone.ani+",'customerId' : "+phone.customerId+",'customerType':"+phone.customerType+",'leadId':"+phone.leadId+"}}}";console.info("params:"+c);var a=SoftPhone.initiateTransfer(1,b,c);if(a==1){return true}return false}function completeTransfer(){if(!checkSoftPhoneApplet()){return false}SoftPhone.completeTransfer(null)}function hold(){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.hold(1,null);if(a==1){return true}return false}function retrieve(){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.retrieve(1,null);if(a==1){return true}return false}function initiateConference(a){if(!checkSoftPhoneApplet()){return false}SoftPhone.initiateConference(1,a,"{params:{UserData:{command:'1'}}}")}function singleStepConference(a){if(!checkSoftPhoneApplet()){return false}SoftPhone.singleStepConference(1,a,"{params:{UserData:{command:'3'}}}")}function completeConference(){if(!checkSoftPhoneApplet()){return false}SoftPhone.completeConference(null)}function notReady(a){console.info("reasonCode:"+a);return notReady(a,0)}function notReady(c,b){console.info("notReady----1:"+c);if(c==null){c="1203"}console.info("notReady----2:"+c);if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.notReady(mediaType,c,b);if(a==1){if(phone){phone.changeStatus(2)}return true}return false}function transferQueue(e,c,b,d){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.transferQueue(e,c,b,transferPerson);if(a==1){return true}return false}function addUserData(d,b,c){if(!checkSoftPhoneApplet()){return false}var a=SoftPhone.addUserData(d,b,c);if(a==1){return true}return false}function dial(c,b){if(!checkSoftPhoneApplet()){return false}isDial=1;var a=SoftPhone.dial(c,b);if(a==1){return true}return false}function sendDtmf(a){if(!checkSoftPhoneApplet()){return false}SoftPhone.sendDtmf(1,a)}function muteOn(){if(!checkSoftPhoneApplet()){return false}console.info("muteOn");SoftPhone.muteOn(1,1)}function muteOff(){if(!checkSoftPhoneApplet()){return false}console.info("muteOff");SoftPhone.muteOff(1,1)}function registerSoftPhone(d,h,c,g,b,f,e,a){if(!checkSoftPhoneApplet()){return false}SoftPhone.register(d,h,c,g,b,f,e,a)}function getDnStatus(b){console.info("getDnStatus_1:"+checkSoftPhoneApplet());if(!checkSoftPhoneApplet()){console.info("getDnStatus_2:"+checkSoftPhoneApplet());return false}var a=SoftPhone.getDnStatus(b);console.info("getDnStatus_3:"+a);return a==0}function appletReady(){onInitialized()}function handleError(a){onError(a)}function handleAgentStatusChanged(a){a=toJSON(a);onAgentStatusChanged(a)}function handleConnectionStatusChanged(a){a=toJSON(a);onConnectionStatusChanged(a)}function handleInteractionAdded(a){try{a=toJSON(a);callbackIsRelease=1;if(a.thisDN!=a.otherDN){onInteractionAdded(a)}}catch(b){alert(b)}}function handleInteractionUpdated(a){try{a=toJSON(a);if(a.thisDN==a.otherDN){dailSelf=1;console.info("dailSelf..."+1)}onInteractionUpdated(a)}catch(b){alert(b)}}function handleInteractionRemoved(a){try{isDial=0;a=toJSON(a);onInteractionRemoved(a)}catch(b){alert(b)}}function toJSON(result){return eval("("+result+")")}function handleUserEvent(a){a=toJSON(a);onUserEvent(a)}function handleHookStatusChanged(a){a=toJSON(a);hookStatusChanged(a)}var callstatus=0;var isRemoved=false;var autoReady=false;var findoutphone=0;var istransferPhone=0;var istransferComing=0;var citOnOff=0;var callbackIsRelease=0;var dailSelf=0;function onInitialized(){}function onAgentStatusChanged(a){if(a.voice=="LoggedIn"){ctiIsLogIn=1;$("#cti_jre").hide();notReady(null);console.info("cti--notReady");phone.changeStatus(2)}else{if(a.voice=="Ready"){phone.changeStatus(0)}else{if(a.voice=="NotReady"){try{if(a.reason==1200){if(phone.status!=7){phone.changeStatus(-1)}notReadyState=0;return}}catch(b){}console.info("notReady>>>>>>>>>>>>>>>>>>>");if(notReadyState==1){phone.changeStatus(1)}else{if(isMyRelease||!isRemoved){if(phone){if(a.reason==1201){phone.changeStatus(1)}else{console.info("reasonCode:"+a.reason);phone.changeStatus(2)}}}}notReadyState=0}else{if(a.voice=="LoggedOut"){ctiIsLogIn=0;phone.changeStatus(15)}}}}isRemoved=false}function onConnectionStatusChanged(a){console.log(a);if(a.voice=="Registered"){login()}else{if(a.voice=="Disconnected"){phone.changeStatus(15)}else{connStatus=0}}$(".connectionStatus").text(a.voice)}function onError(a){showCtiError(a);console.log(a)}function onInteractionAdded(a){isMyRelease=false;autoReady=false;console.log("onInteractionAdded:"+a);if(a.status=="Ringing"){callstatus=0;isInitiate=0;phone.ctisdt=a.timeStamp;console.info("istransferComing:"+istransferComing);if(istransferComing==0){callAnswer()}else{istransferComing=1}try{if(a.attachedData.RTargetRequested){console.info("设置坐席等级------");$("#d_employeeType").html(getAagentLevel(a.attachedData.RTargetRequested))}else{console.info("设置坐席等级------");$("#d_employeeType").html("--")}}catch(b){console.info("设置坐席等级------")}try{if(a.attachedData.SKILL_GROUP){phone.acdId=a.attachedData.SKILL_GROUP;console.info("result.acdId------"+phone.acdId)}else{console.info("result.acdId------");phone.acdId=""}}catch(b){console.info("result.acdId------");phone.acdId=""}if(a.callType!="Consult"){console.info("正常进线...");comingIn(a.ani,a.dnis,a.connId,a.status,null,null,null)}else{try{if(a.attachedData.batch){console.info("预测外呼");phone.campainId=a.attachedData.batch;comingIn(a.attachedData.GSW_PHONE.substr(1),a.thisDN,a.connId,a.status,null,null,null)}else{phone.campainId="";comingIn(a.attachedData.ani,a.dnis,a.connId,a.status,a.attachedData.customerId,a.attachedData.customerType,a.attachedData.leadId)}}catch(b){phone.campainId="";console.info("result.campainId------")}}}else{if(a.status=="Dialing"&&a.callType!="Consult"){callstatus=1;isInitiate=0;console.info("外呼...");try{console.info(83);document.getElementById(outphoneFrameId).contentWindow.loadingFadeOut()}catch(b){}console.info("findoutphone:"+findoutphone);if(findoutphone!=1){phone.changeStatus(5)}}else{if(a.attachedData.command==2){completeTransfer()}}}}function onInteractionUpdated(a){console.log("onInteractionUpdated:"+a);if(a.callType=="Outbound"&&a.status=="Established"){if(findoutphone==1){phoneOUTcallback()}else{phone.ctisdt=a.timeStamp;dialCallback(a)}findoutphone=0}if(a.callType=="Consult"&&a.status=="Established"){try{if(a.attachedData.command==1){if(istransferPhone==0){}else{console.info(125);istransferPhone=1;$("#div_transferPhone").attr("class","c_combo ok");$("#div_transferPhone").attr("title","完成")}}}catch(b){console.info("result.attachedData.command:"+b)}}else{if(a.callType=="Consult"){console.info(132);try{if(a.attachedData.command==1){}}catch(b){console.info("result.attachedData.command:"+b)}}}}function onInteractionRemoved(a){callbackIsRelease=0;if($("#notelist").combobox("getValue")==a.otherDN){return}if(a.thisDN!=a.otherDN){phone.ctiedt=a.timeStamp;phone.cticonnid=a.connId;try{if($("#callback").val()==1){$.get("/common/callback/setCtiInfo",{v_leadInterId:phone.leadInterId,ctiedt:phone.ctiedt,connId:phone.cticonnid})}else{$.get("/common/setCtiInfo",{h_instId:phone.instId,ctiedt:phone.ctiedt,connId:phone.cticonnid})}}catch(b){console.info("保存CtiInfo失败!!")}if(a.callType!="Consult"){console.info("phone.changeStatus:"+phone.status);phone.changeStatus(7);if(!isMyRelease){if(callstatus==0){console.info("interrupt4");if(autoReady==false){notReady("1202",3);console.info("notReady:cti :113");interrupt(4)}else{ready()}}else{if(autoReady==false){notReady("1202",3);console.info("notReady:cti :116");interrupt(6)}else{ready()}console.info("interrupt6")}}else{notReady("1202",3);console.info("notReady:cti :210")}findoutphone=0;isRemoved=true;console.log("onInteractionUpdated:"+a)}else{try{if(a.attachedData.command==1){return}}catch(b){}phone.ctiedt=a.timeStamp;console.info("phone.changeStatus:"+phone.status);phone.changeStatus(7);if(!isMyRelease){if(callstatus==0){console.info("interrupt4");if(autoReady==false){notReady("1202",3);console.info("notReady:cti :113");interrupt(4)}else{ready()}}else{if(autoReady==false){notReady("1202",3);console.info("notReady:cti :116");interrupt(6)}else{ready()}console.info("interrupt6")}}else{notReady("1202",3);console.info("notReady:cti :210")}findoutphone=0;isRemoved=true;console.log("onInteractionUpdated:"+a)}}else{console.info("dailSelf..."+0);dailSelf=0}}function onUserEvent(b){console.info("onUserEvent...."+b);switch(b.command){case"ready":ready();console.info("ready");break;case"notready":notReady();console.info("notready");break;case"releasecall":release();console.info("releasecall");break;case"bargein":console.info("bargein"+b.targetDN);singleStepConference(b.targetDN);console.info("bargein");break;case"message":console.info("message");var e=b.type;var d=b.agentId;var c=date2str(new Date(),"yyyy-MM-dd hh:mm:ss");console.info(c);var a=b.message;if(e==1){e="现场主管";bottomLeft(e,d,c,a)}else{e="业务主管";bottomRight(e,d,c,a)}break}}function date2str(x,y){var z={M:x.getMonth()+1,d:x.getDate(),h:x.getHours(),m:x.getMinutes(),s:x.getSeconds()};y=y.replace(/(M+|d+|h+|m+|s+)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-2)});return y.replace(/(y+)/g,function(v){return x.getFullYear().toString().slice(-v.length)})}function hookStatusChanged(a){console.info("onUserEvent...."+a);if(a=="onHook"){citOnOff=0;console.info("onUserEvent....（０）："+a);if(getDnStatus(null)){changeCtiOnAndOff_on();if(phone.status=="-1"){phone.leavingReason="";notReady("1203");phone.changeStatus(2)}}else{changeCtiOnAndOff_off()}}else{citOnOff=1;changeCtiOnAndOff_off();if(callbackIsRelease==0&&$("#ctiPhoneType").val()==1){if(isDial==0){notReady("1200")}}console.info("onUserEvent....（１）："+a)}}function onOffHook(d,b,e,f,c,a){console.info("onOffHook>>>");$("#wrapper").removeAttr("class").addClass("onoffhook");$("#state a.c_btn").html("摘机").attr("for","leave").unbind().bind("click",function(){changeS(this)});$("#callContext").html('<span class="incoming fl"></span>');$("#state .arrow").unbind().bind("click",function(){toggleS()});$("a.logout").unbind();$("#callback").unbind().bind("click",function(){changeCS(this)});$("#state li").unbind().bind("click",function(){toggleSC(this)});$("#outbtn").unbind().bind("click",function(){outCall(phone)});$("table.keyboard a").unbind().bind("click",function(){toggleSPE(this)});$("#softphoneWrap").unbind().bind("click",function(){toggleSP()})}function onReady(d,b,e,f,c,a){$("#callContext").html('<span class="incoming fl"></span>');$("#wrapper").removeAttr("class").addClass("onReady");$("#state a.c_btn").html("就绪").attr("for","leave").unbind().bind("click",function(){changeS(this)});console.log("5+就绪"+_source);$("#state").unbind().bind("click",function(){toggleS()});$("a.logout").unbind();$("#callback").unbind().bind("click",function(){changeCS(this)});$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});$("#state li").unbind().bind("click",function(){toggleSC(this)});$("table.keyboard a").unbind().bind("click",function(){toggleSPE(this)});$("#outbtn").unbind().bind("click",function(){outCall(phone)});$("#transferPhoneBtn").unbind()}function onReadyOut(d,b,e,f,c,a){$("#wrapper").removeAttr("class").addClass("onReadyOut");$("#callContext").html('<span class="incoming fl"></span>');$("#state a.c_btn").html("就绪(可外呼)").attr("for","ready").unbind().bind("click",function(){changeS(this)});$("#state .arrow").unbind().bind("click",function(){toggleS()});$("#callback").unbind().bind("click",function(){changeCS(this)});$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});$("table.keyboard a").unbind().bind("click",function(){toggleSPE(this)});$("#outbtn").unbind().bind("click",function(){outCall(phone)});$("#transferPhoneBtn").unbind()}function onLeaving(d,b,e,f,c,a){$("#wrapper").removeAttr("class").addClass("onLeaving");$("#state a.c_btn").html("离席").attr("for","ready").unbind().bind("click",function(){changeS(this)});if(phone.leavingReason){$("#state a.c_btn").html("离席("+phone.leavingReason+")").attr("for","ready").unbind().bind("click",function(){changeS(this)})}$("#callContext").html('<span class="incoming fl"></span>');$("#state .arrow").unbind().bind("click",function(){toggleS()});$("a.logout").unbind().bind("click",function(){logout()});$("#callback").unbind().bind("click",function(){changeCS(this)});$("#state li").unbind().bind("click",function(){toggleSC(this)});$("#outbtn").unbind().bind("click",function(){outCall(phone)});$("table.keyboard a").unbind().bind("click",function(){toggleSPE(this)});$("#softphoneWrap").unbind().bind("click",function(){toggleSP()})}function onRinging(d,b,e,f,c,a){$("#callContext").css({width:30,"padding-left":0,"padding-right":0,"margin-right":"0"});$("#callContext .incoming").addClass("incoming_ac").show();$("#transferPhoneBtn").unbind()}function onTalking(d,b,e,f,c,a){$("#callContext").html('<span class="insure">'+phone.insure+'</span><span class="incoming incoming_ac fl"></span><span class="callin fl"><font id="time" class="time fl"></font><div id="num" class="clearfix"><span id="marquee" class="fl ml5 c_combo pl5"  style="height:25px;padding-right:18px">'+d+'<span class="arrow"></span></span><div class="marquee_hover pl5 pr5"><div>'+d+"("+a+')</div><div class="">&nbsp;<a id="local" class="callback" onclick="callLocalhost(this);">本地</a>&nbsp;<a id="long" class="callback" onclick="callLongDistance(this);">长途</a>&nbsp;<a class="addBlacklist" onclick="addBlack(this);">加黑</a>&nbsp;</div></div></div>'+c+"&nbsp;&nbsp;&nbsp;"+phone.dnsi+'</span><a id="onHook" title="挂机" class="onHook" href="javascript:void(0)"></a>');if($("#callback").attr("value")==1){$("#onHook").replaceWith('<span class="onHook"></span>')}$("#callContext").animate({width:$("#callContext").find(".callin").width()+50,paddingLeft:"30px",paddingRight:0,marginRight:"35px"},0,function(){$(this).width("")});$("#onHook").one("click",function(){$("#transferPhoneBtn").unbind();isMyRelease=true;console.info("release:"+177);if(phone.isOutBoound){document.getElementById(outphoneFrameId).contentWindow.loadingFadeOut()}release();phone.changeStatus(7)});$("#num").hover(function(){$(".marquee_hover").fadeIn()},function(){$(".marquee_hover").fadeOut()});if(countup!=null){countup.reset()}countup=$.countup(timer);$("#state a.c_btn").html("通话中").attr("for","hold");$("#wrapper").removeAttr("class").addClass("onTalking");if(f){$("#callContext .incoming").addClass("incoming_out")}$("#callback").unbind();$("a.logout").unbind();$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});$("table.keyboard a").unbind().bind("click",function(){toggleSPE(this)});$("#transferPhoneBtn").css("opacity",1).unbind().bind("click",function(){$("#div_transferPhone").attr("class","c_combo throughconnect");transferPhone()})}function onDialing(d,b,e,f,c,a){$("#callContext").css({width:30,"padding-left":0,"padding-right":0,"margin-right":"0"});$("#callContext").html('<span class="insure">'+phone.insure+'</span><span class="incoming incoming_ac fl"></span><span class="callin fl"><font id="time" class="time fl"></font><div id="num" class="clearfix"><span id="marquee" class="fl ml5 c_combo pl5"  style="height:25px;padding-right:18px">'+d+"("+a+')<span class="arrow"></span></span><div class="marquee_hover pl5 pr5"><div>'+d+"("+a+')</div><div class="">&nbsp;<a id="local" class="callback" onclick="callLocalhost(this);">本地</a>&nbsp;<a id="long" class="callback" onclick="callLongDistance(this);">长途</a>&nbsp;<a class="addBlacklist" onclick="addBlack(this);">加黑</a>&nbsp;</div></div></div>'+c+""+e+""+phone.dnsi+'</span><a id="onHook" title="挂机" class="onHook" href="javascript:void(0)"></a>');$("#callContext").animate({width:$("#callContext").find(".callin").width(),paddingLeft:"30px",paddingRight:0,marginRight:"35px"},"slow",function(){$(this).width("")});$("#onHook").one("click",function(){isMyRelease=true;console.info("release:"+238);release();phone.changeStatus(7);$("#onHook").replaceWith('<span class="onHook"></span>')});$("#num").hover(function(){$(".marquee_hover").fadeIn()},function(){$(".marquee_hover").fadeOut()});countup=null;$("#state a.c_btn").html("呼出中").unbind();$("#state .arrow,#state").unbind();$("#callContext .incoming").addClass("incoming_out");$("#wrapper").removeAttr("class").addClass("onTalking").addClass("cOff")}function onTalkingOut(d,b,e,f,c,a){if(countup==null){countup=$.countup(timer)}$("#state a.c_btn").html("呼出通话中").attr("for","hold").unbind().bind("click",function(){changeS(this)});$("#state").unbind().bind("click",function(){toggleS()});$("#wrapper").removeClass("cOff");if(f){}$("#callback").unbind();$("a.logout").unbind();$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});$("#transferPhoneBtn").css("opacity",1).unbind().bind("click",function(){$("#div_transferPhone").attr("class","c_combo throughconnect");transferPhone()})}function onProcessing(d,b,e,f,c,a){if(countup!=null){countup.stop()}if($("#callback").attr("value")==0){$("#callContext").css("margin-right","55px").append('<a id="end" class="end" title="结束会话" onclick="javascript:openhookwin();"></a>')}$("#outcon").text("挂机后处理");$("#onHook").replaceWith('<span class="onHook"></span>');$("#callContext .incoming").removeClass("incoming_ac").addClass("loading");$("#wrapper").removeAttr("class").addClass("onProcessing");$("#state a.c_btn").html("后处理").attr("for","talking");$("#transferPhoneBtn").css("opacity",0.4).unbind();$("#throughconnect-arrow").unbind();$("#state .arrow").unbind();$("#state").unbind();$("#softphoneWrap").unbind();$("body").click()}function onHolding(d,b,e,f,c,a){$("#wrapper").removeAttr("class").addClass("onHolding");$("#state a.c_btn").html("保持").attr("for","ready");$("#softphoneWrap").unbind();console.info("hold-293");hold()}function mute(){$("#wrapper").addClass("onmuting");$("#state a.c_btn").html("静音").attr("for","unmute");$("#softphoneWrap").unbind();muteOn()}function unmute(){$("#wrapper").removeClass("onmuting");if(phone.status==4){$("#state a.c_btn").html("通话中")}else{if(phone.status==6){$("#state a.c_btn").html("呼出通话中")}}$("#softphoneWrap").unbind();muteOff()}function onOutringing(d,b,e,f,c,a){$("#callContext").css({width:30,"padding-left":0,"padding-right":0,"margin-right":"0"});$("#callContext").html('<span class="incoming incoming_ac fl"></span><span class="callin fl"><font id="time" class="time fl"></font><div id="num" class="clearfix"><span id="marquee" class="fl ml5 c_combo pl5"  style="height:25px;padding-right:18px">'+d+""+a+'<span class="arrow"></span></span><div class="marquee_hover pl5 pr5"><div>'+d+""+a+'</div><div class="">&nbsp;<a class="callback" onclick="callLocalhost(this);">本地</a>&nbsp;<a class="callback" onclick="callLongDistance(this);">长途</a>&nbsp;<a class="addBlacklist" onclick="addBlack(this);">加黑</a>&nbsp;</div></div></div>'+c+""+e+""+b+'</span><a id="onHook" title="挂机" class="onHook" href="javascript:void(0)"></a>');$("#callContext").animate({width:$("#callContext").find(".callin").width(),paddingLeft:"30px",paddingRight:0,marginRight:"35px"},"slow",function(){$(this).width("")});$("#onHook").one("click",function(){isMyRelease=true;console.info("release:"+238);release();phone.changeStatus(7);$("#onHook").replaceWith('<span class="onHook"></span>')});$("#num").hover(function(){$(".marquee_hover").fadeIn()},function(){$(".marquee_hover").fadeOut()});$("#callContext .incoming").addClass("incoming_out");$("#state a.c_btn").html("呼出中");$("#wrapper").removeAttr("class").addClass("onTalking")}function onOutcall(d,b,e,f,c,a){if(countup!=null){countup.reset()}countup=$.countup(timer);$("#state a.c_btn").html("呼出通话中").attr("for","hold");$("#wrapper").removeAttr("class").addClass("onTalking");if(f){}$("#callback").unbind();$("a.logout").unbind()}function offline(ani,dnsi,tollFreeNum,isOutBoound,company,province){$("#wrapper").removeAttr("class").addClass("offline");$("#state a.c_btn").html("未登录");$("#softphoneWrap").unbind();$("#callback").unbind();$("#state").unbind();$("a.logout").unbind().bind("click",function(){logout()});if(eval($("#isLoadSoftPhone").val())){$("#state .arrow").unbind().bind("click",function(){toggleS()});$("#state li").unbind().bind("click",function(){toggleSC(this)});$("#state a.c_btn").attr("for","leave").unbind().bind("click",function(){changeS(this)})}else{$("#state").addClass("discombo")}}function setCallBack(){switch($("#callback").attr("value")){case"0":$("#left,#right,#apptabs").find(".c_mask").remove();break;case"1":if($("#left .c_mask,#right .c_mask,#apptabs .c_mask").length==0){$("#left,#right").append('<div class="c_mask"></div>');$("#apptabs").append('<div class="c_mask" style="padding-top:3px;border-radius:5px 5px 0 0"></div>')}break}}function toggleS(){$("#state").addClass("selected");event.stopPropagation();colseSel($("#state"))}function changeS(a){event.stopPropagation();switch($(a).attr("for")){case"ready":if(phone.status==12){console.info("取回保持＞＞＞＞");retrieve();if(phone.isOutBoound){$("#state a.c_btn").html("呼出通话中").attr("for","hold");$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});phone.status=6}else{$("#state a.c_btn").html("通话中").attr("for","hold");$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});phone.status=4}$("#wrapper").removeAttr("class").addClass("onTalking");break}else{if(isDailSelf()){return}phone.changeStatus(0);ready();console.info("ready:"+345)}break;case"leave":if(phone.status==15){ctilogin();break}$("li.leave dl dt").toggleClass("open").nextAll().show();toggleS();break;case"hold":phone.changeStatus(12);break}}function flod(){$("li.leave dl dt").unbind().bind("click",function(){$(this).toggleClass("open").nextAll().slideToggle()});$("li.leave dl dd").unbind().bind("click",function(){console.info("click leave reson...");if(isDailSelf()){return}notReady($(this).attr("value"));console.info("notReady:375");event.stopPropagation();$("#state").removeClass("selected");$("#state ul").slideUp();$(this).parent().find("dd").hide();phone.leavingReason=$(this).text();phone.changeStatus(2)})}function changeCS(a){switch(parseInt($(a).attr("value"))){case 0:$("#local,#long").hide();$(a).removeAttr("class").addClass("callback_y").attr("value","1");phone._expir=40;break;case 1:$("#local,#long").show();$(a).removeAttr("class").addClass("callback_n").attr("value","0");$("#left,#right,#apptabs").find(".c_mask").remove();phone._expir=300;destoryTab("CallbackTab");break}}function colseSel(a){$("body").click(function(){if(a.hasClass("opened")){a.removeClass("opened");clearProvinceCity()}else{if(a.hasClass("selected")){a.removeClass("selected")}else{if(a.hasClass("on")){a.removeClass("on")}}}$("#div_transferPhone").removeClass("twoBtns")})}function toggleSP(){$("#softphoneWrap").addClass("opened");event.stopPropagation();$("#delNum").unbind().bind("click",function(){$("#notelist").combobox("setValue","")});colseSel($("#softphoneWrap"))}function toggleSPE(a){if($("#notelist").combobox("getValue").length<5){$("#notelist").combobox("setValue",$("#notelist").combobox("getValue")+""+$(a).text())}}function keyComboxE(a){$("#pnum").attr("value",$(a).text());$("#pnum a").eq(0).html($(a).text()+'<span class="arrow"></span>');$("#pnum").removeClass("selected");$("#pnum a.delNum").show()}function outCall(b){console.info("======================"+getDnStatus(null));if(checkSoftPhoneApplet()){if($("#ctiPhoneType").val()==1){if(callbackIsRelease==1){msgSlide("分机资源忙!");return}else{if(getDnStatus(null)){msgSlide("电话没有摘机，请摘机！！");return}}}}if(isDailSelf()){return}event.stopPropagation();console.info("phoneNo580:"+$("#citylist").combobox("getValue"));var c=$("#citylist").combobox("getValue").trim()+""+$("#notelist").combobox("getValue"),a=$("#prolist").combobox("getValue")+$("#citylist").combobox("getValue");console.info("phoneNo581:"+c);console.info("phoneNo582:"+a);if(c.trim().length==0){return}console.info("phoneNo"+c);switch(b.status){case 0:alertWin("系统提示","就绪状态,不可通过软电话盘外呼!");break;case 1:phoneOUTfun(c);phoneOUT.changeStatus(13);b.status=13;if(checkSoftPhoneApplet()){findoutphone=1;dial("8"+c,null)}break;case 2:phoneOUTfun(c);phoneOUT.changeStatus(13);if(checkSoftPhoneApplet()){findoutphone=1;dial("8"+c,null)}break;case 4:break;case 6:if(checkSoftPhoneApplet()){console.info("638");sendDtmf(c)}case 14:if(checkSoftPhoneApplet()){console.info("638");sendDtmf(c)}break}$("#softphoneWrap").removeClass("opened");$("#notelist,#prolist,#citylist").combobox("setValue","")}function phoneOUTcallback(){phoneOUT.changeStatus(13);phoneOUT.changeStatus(14);phone.status=14}function delCon(a){$("#pnum a.white").html('<span class="arrow"></span>');$("#pnum a.delNum").hide()}function toggleSC(a){event.stopPropagation();switch($(a).attr("class")){case"loginphone":ctilogin();$("#state").removeClass("selected");break;case"ready":$("#state").removeClass("selected");if(phone.status==12){console.info("取回保持＞＞＞＞");retrieve();if(phone.isOutBoound){$("#state a.c_btn").html("外呼通话中").attr("for","hold");phone.status=6}else{$("#state a.c_btn").html("通话中").attr("for","hold");phone.status=4}$("#wrapper").removeAttr("class").addClass("onTalking");break}else{phone.changeStatus(0);ready();console.info("ready:"+503);break}case"readyout":$("#state").removeClass("selected");notReady(1201);break;case"cancelHold":$("#state").removeClass("selected");if(phone.status==12){console.info("取回保持＞＞＞＞");retrieve();if(phone.isOutBoound){$("#state a.c_btn").html("外呼通话中").attr("for","hold");$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});phone.status=6}else{$("#state a.c_btn").html("通话中").attr("for","hold");$("#softphoneWrap").unbind().bind("click",function(){toggleSP()});phone.status=4}$("#wrapper").removeAttr("class").addClass("onTalking")}break;case"leave":return;break;case"hold":console.info("hold-502");console.info("hold--list");$("#state").removeClass("selected");phone.changeStatus(12);break;case"mute":$("#state").removeClass("selected");mute();break;case"unmute":$("#state").removeClass("selected");unmute();break}}function timer(b,c){var a='<span id="min">('+c.minute+'</span>:<span id="sec">'+c.second+")</span>";if(phone.status==4){if(countup!=null){if(c.total>phone._expir){$("#time").toggleClass("yel");setTimeout(function(){$("#time").toggleClass("yel")},500)}}}if(c.total>3600){a='<span id="hour">('+c.hour+'</span>:<span id="min">'+c.minute+'</span>:<span id="sec">'+c.second+")</span>"}$("#time").html(a)}var countup=null;var phone=null;$(function(){phone=new AcornPhone();phone.onOffHook=onOffHook;phone.onLeaving=onLeaving;phone.onReady=onReady;phone.onTalking=onTalking;phone.onProcessing=onProcessing;phone.onHolding=onHolding;phone.onRinging=onRinging;phone.onReadyOut=onReadyOut;phone.onOutringing=onOutringing;phone.onOutcall=onOutcall;phone.offline=offline;phone.init();flod();if($.browser.mozilla){var a=function(){var b=a.caller;while(b.caller){b=b.caller}return b.arguments[0]};__defineGetter__("event",a)}$("#add1 a").click(function(){event.stopPropagation();$("#add1").addClass("selected")});$("#add2 a").click(function(){event.stopPropagation();$("#add2").addClass("selected")});$("#add1 li,#add2 li").click(function(){$(this).parent().parent().attr("value",$(this).text());$(this).parent().prev().find("span.c_context").text($(this).text())});$("#interrupt").click(function(){interrupt()});$("#inbb").click(function(){inphone()});$("#outbb").click(function(){w_outhone()});$("#hooksave").click(function(){$("#savetip").hide();var d=$("#d_selcontact").attr("checked")?true:false,b=$("#h_isContact").attr("checked")?true:false;if(d&&b){if($("#d_seat").combobox("getValue").length==0){$("#d_seat").combobox("setValue","")}}phone.insure="";var c="";console.info(getDnStatus(null));$("#hookMsg").html("");$("#callResult").selectedIndex=0;$("#callType").selectedIndex=0;console.info("hooksave1:"+checkSoftPhoneApplet());if(checkSoftPhoneApplet()){console.info("hooksave2:"+getDnStatus(null));if(!getDnStatus(null)){console.info("hooksave3:"+getDnStatus(null));$("#savetip").show();return}}if(phone.isOutBoound){c=phone.instId}else{c=getRecommandTaskId()}if(typeof(c)=="undefined"){w_indexId=""}if($("#h_hookForm").form("validate")){$.ajax({type:"post",async:false,url:"/common/outbound/hook",data:{isContact:b,contactTime:$("#h_contactTime").datetimebox("getValue"),remark:$("#h_remark").val(),h_instId:c,ani:phone.ani,dani:phone.dnsi,time_length:phone.seconds,marketingPlan:$("#d_marketingPlan").combobox("getValue"),d_reson:$("#d_reson").combobox("getValue"),isOutbound:phone.isOutBoound,d_selcontact:d,d_dept:$("#d_dept").combobox("getValue"),d_group:$("#d_group").combobox("getValue"),d_seat:$("#d_seat").combobox("getValue"),ctiedt:phone.ctiedt,callid:phone.cticonnid,callResult:$("#callResult").val(),callType:$("#callType").val(),acdId:phone.acdId},dataType:"json",success:function(f){try{var g=parseInt($("input[name='hook_st']:checked").val());phone.changeStatus(g);switch(g){case 0:if(checkSoftPhoneApplet()){ready();console.info("ready:"+629)}else{phone.changeStatus(0)}break;case 1:notReadyState=1;if(checkSoftPhoneApplet()){notReady("1201");console.info("ready:"+632)}else{phone.changeStatus(1)}break;default:if(checkSoftPhoneApplet()){phone.leavingReason=$("#notReadyCode").combobox("getText");notReady($("#notReadyCode").combobox("getValue"));console.info("notReady 637")}else{phone.changeStatus(2)}}}catch(e){console.info("保存通话结果异常::"+e)}finally{if(phoneOUT){phoneOUT=null}$("#hook").window("close");$("#h_contactTime").datetimebox("setValue","");$("#h_contactTime").datetimebox("disable");$("#d_selectTask").css("display","none");$("#span_intradayTotalOutcallTime").html(f.totalOutcallTime+"秒");closeAllTabs();if(b){if($("#d_marketingPlan").combobox("getValue")=="10"){if(phone.customerId.length>1){gotoInfoCustomer(phone.customerId,phone.customerType,phone.customerId,false)}}}}},error:function(){$("#hook").window("close");closeAllTabs();console.info("post fail in url=/common/outbound/hook");alertWin("系统提示","post failed in url=/common/outbound/hook");phone.changeStatus(2);if(phoneOUT){phoneOUT=null}}})}})});function inphone(){$("#w_inphone").window("open")}function w_outhone(){$("#w_outphone").window("open")}function w_outPhoneCall(){$("#w_outphone").window("close");var a=$("#d_outPhone").val();phone=new AcornPhone(a,$("#d_dn").html(),"",true);phone.boundType=0;phone.onLeaving=onLeaving;phone.onOffHook=onOffHook;phone.onReady=onReady;phone.onTalking=onTalking;phone.onProcessing=onProcessing;phone.onHolding=onHolding;phone.onRinging=onRinging;phone.onDialing=onDialing;phone.onTalkingOut=onTalkingOut;phone.onReadyOut=onReadyOut;phone.onOutringing=onOutringing;phone.onOutcall=onOutcall;phone.offline=offline;cleanOnHook();dial("8"+phone.ani,null)}var phone1="",phone2="",phone3="",phoneType="",isCloseFindC=true,taskId="",phoneOUT=null,isMyRelease,outphoneFrameId=null;var isSoftPhoneLogin=0;function outphone(d,f,b,h,e,a,g){try{outphoneFrameId=g}catch(c){}if(checkSoftPhoneApplet()){if($("#ctiPhoneType").val()==1){if(callbackIsRelease==1){document.getElementById(outphoneFrameId).contentWindow.loadingFadeOut();msgSlide("分机资源忙!");return}else{if(getDnStatus(null)){document.getElementById(outphoneFrameId).contentWindow.loadingFadeOut();msgSlide("电话没有摘机，请摘机！！");return}}}}if(isDailSelf()){return}phone=new AcornPhone(d,$("#d_dn").html(),"",true);phone.boundType=a;phone.onLeaving=onLeaving;phone.onOffHook=onOffHook;phone.onReady=onReady;phone.onTalking=onTalking;phone.onProcessing=onProcessing;phone.onHolding=onHolding;phone.onRinging=onRinging;phone.onDialing=onDialing;phone.onTalkingOut=onTalkingOut;phone.onReadyOut=onReadyOut;phone.onOutringing=onOutringing;phone.onOutcall=onOutcall;phone.offline=offline;phone.instId=b;phone.customerId=h;phone.customerType=e;cleanOnHook();outgoingCall("",phone.instId);$.ajax({type:"post",url:"/common/fatch/message",data:"h_instId="+phone.instId+"&ani="+phone.ani+"&dani="+phone.dnsi+"&boundType="+phone.boundType+"&ctisdt="+phone.ctisdt,async:false,dataType:"json",success:function(j){}});if(checkSoftPhoneApplet()){if(phone.ani.substring(0,1)==1){if(f==2){console.info("dial1.............");dial("80"+phone.ani,null)}else{console.info("dial2.............");dial("8"+phone.ani,null)}}else{if(f==2){console.info("dial1.............");dial("8"+phone.ani,null)}else{console.info("dial2.............");if(phoneType!=4){dial("8"+phone2,null)}else{dial("8"+phone.ani,null)}}}}else{console.info("没有加载软电话");phone.changeStatus(5);phone.changeStatus(6);$("#h_instId").val(phone.instId)}}function phoneNoMask(b){if(b){var a=b.substring(0,b.length-4);return a+"****"}else{return""}}function dialCallback(a){console.info("外呼回调");phone.dnsi=a.thisDN;phone.changeStatus(6);phone.connStates=a.status;phone.cticonnid=a.connId;$("#h_instId").val(phone.instId);$.ajax({type:"post",url:"/common/fatch/message/callback",data:"h_instId="+phone.instId+"&ani="+phone.ani+"&dani="+phone.dnsi+"&boundType="+phone.boundType+"&connId="+a.connId+"&ctisdt="+phone.ctisdt,async:false,dataType:"json",success:function(b){}})}function phoneOUTfun(a){phoneOUT=new AcornPhone(a,$("#d_dn").html(),"",true);phoneOUT.boundType="";phoneOUT.onOffHook=onOffHook;phoneOUT.onLeaving=onLeaving;phoneOUT.onReady=onReady;phoneOUT.onTalking=onTalking;phoneOUT.onProcessing=onProcessing;phoneOUT.onHolding=onHolding;phoneOUT.onRinging=onRinging;phoneOUT.onDialing=onDialing;phoneOUT.onTalkingOut=onTalkingOut;phoneOUT.onOutringing=onOutringing;phoneOUT.onOutcall=onOutcall}function cleanOnHook(){$("#h_remark").val("");$("#h_contactTime").datetimebox("setValue","");$("#h_isContact").attr("checked",false);$("#h_instId").val("")}function outPhone2(b,a){$.post("/customer/mycustomer/phone/find",{phone:b},function(d){if(d.result){if(d.total==1){var c=d.rows;var e=c[0];phone.customerId=e.contactId;phone.customerType=e.contactType;phone.ani=b;if(a!=null&&a!=""){relateContactWithTask(e.contactId,a,true);a=""}gotoInfoCustomer(e.contactId,phone.customerType,phone.ani,false)}else{if(a!=null&&a!=""){window.taskId=a;queryCustomer("","relateContactWithTask","outCall",b);findCustomer()}}}else{$.ajax({type:"post",url:"/common/splicePhone",data:"inPhone="+b,async:false,dataType:"json",success:function(f){if(f.result){phone.province=f.dto.provName+f.dto.cityName;phone1=f.dto.phn1;phone2=f.dto.phn2;phone3=f.dto.phn3;$("#d_provid").val(f.dto.provid);$("#d_cityid").val(f.dto.cityid);phoneType=f.dto.phonetypid}else{phone.province="";alertWin("系统提示",f.msg);return}$.post("/customer/mycustomer/potentialContact/add",{phn1:phone1,phn2:phone2,phn3:phone3,phonetype:phoneType},function(g){if(g.result){phone.customerId=g.potentialContactId;phone.customerType="2";if(a!=null&&a!=""){relateContactWithTask(g.potentialContactId,a,true);a=""}gotoInfoCustomer(g.potentialContactId,2,phone.ani,false)}else{}})}})}})}function comingIn(f,b,g,h,d,c,e){phone.isOutBoound=false;phone.leadId="";phone.customerId="";phone.customerType="";phone.isOutBoound=false;if(!checkSoftPhoneApplet()){f=$("#d_inPhone").val();b=$("#d_dnis").val()}else{phone.cticonnid=g;phone.connStates=h;if(d!=null&&c!=null){phone.customerId=d;phone.customerType=c;phone.leadId=e;if(phone.status!=2){istransferComing=1;return}}else{istransferComing=0;phone.customerId="";phone.customerType="";phone.leadId=""}}var a="";phone.ani=f;$.ajax({type:"post",url:"/common/splicePhone",data:"inPhone="+f,async:false,dataType:"json",success:function(j){if(j.result){insrueCheck(b,j.dto.provName,j.dto.cityName);phone.province=j.dto.provName+j.dto.cityName;phone1=j.dto.phn1;phone2=j.dto.phn2;phone3=j.dto.phn3;$("#d_provid").val(j.dto.provid);$("#d_cityid").val(j.dto.cityid);phoneType=j.dto.phonetypid}else{phone.province="";alertWin("系统提示",j.msg);return}}});if(phoneType==4){phone.ani=phone2}phone.dnsi=b;phone.isOutBoound=false;phone.changeStatus(3);console.info("3333振铃");phone.changeStatus(4);console.info("444通话中");cleanOnHook();$("#w_inphone").window("close")}function insrueCheck(c,a,b){$.ajax({type:"post",url:"/cart/insureValidate",data:{dnis:c,provinceName:a,cityName:b},async:false,dataType:"json",success:function(d){phone.insure="";if(d){phone.insure="(大都会赠险活动)"}},error:function(d){phone.insure=""}})}$(document).ready(function(){$("#h_isContact").bind("click",function(){$("#warnMsg").html("");changeIsContact()});$("#d_selcontact").bind("click",function(){changeSelConact()});$("#d_marketingPlan").combobox({onSelect:function(a){if(a.id!=10){$("#v_reson").hide()}else{$("#v_reson").show()}}})});var changeSelConact=function(){var a=$("#d_selcontact").attr("checked")?true:false;if(a){$("#d_seat").combobox({required:true})}else{$("#d_seat").combobox({required:false})}};var changeIsContact=function(){$("#warnMsg").html("");var a=$("#h_isContact").attr("checked")?true:false;$.ajax({type:"post",url:"/common/get/CurrentPlanAndPlanList",data:"h_instId="+phone.instId+"&customerId="+phone.customerId,async:false,dataType:"json",success:function(b){if(!b.isfinished){$("#d_marketingPlan").combobox({disabled:true})}else{$("#d_marketingPlan").combobox({disabled:false})}if(a){if(b.boundCustomer){if($("#seatType").val()=="IN"){$("#h_contactTime").datetimebox({required:true,validType:"istoday[true]"})}else{$("#h_contactTime").datetimebox({required:false,validType:"istoday[false]"});$("#h_isContact").attr("checked",false);$("#h_isContact").attr("disabled",true);$("#d_selectTask").css("display","none");$("#warnMsg").html("此客户已被其他座席绑定");return false}}else{$("#h_contactTime").datetimebox({required:false,validType:"istoday[false]"})}}else{$("#h_contactTime").datetimebox({required:false,validType:"istoday[false]"})}$("#warnMsg").html("");$("#d_marketingPlan").combobox({data:b.leadTypeList,valueField:"id",textField:"name",onLoadSuccess:function(){$.each(b.leadTypeList,function(c,d){if(d.id==b.campaignId){$("#d_marketingPlan").combobox("setValue",b.campaignId)}else{if(c==0){$("#d_marketingPlan").combobox("setValue",d.id)}}})}})}});if(a){$("#h_contactTime").datetimebox("enable");$("#d_selectTask").css("display","block");if(phone.isOutBoound){$("#v_selcontact").hide()}else{$("#v_selcontact").show()}}else{$("#h_contactTime").datetimebox("setValue","");$("#h_contactTime").datetimebox("disable");$("#d_selectTask").css("display","none")}$("#d_dept").combobox({url:"/common/getAllDept",valueField:"id",textField:"name",onSelect:function(c){var b="/common/getGroupByDept?deptId="+c.id;$("#d_group").combobox("reload",b);$("#d_group").combobox("setValue","");$("#d_seat").combobox("setValue","")}});$("#d_group").combobox({url:"/common/getAllGroup",valueField:"id",textField:"name",onSelect:function(c){var b="/common/getSeatByGroup?groupId="+c.id;$("#d_seat").combobox("reload",b);$("#d_seat").combobox("setValue","")}});$("#d_seat").combobox({valueField:"userId",textField:"displayName",keyHandler:{query:function(b){console.info(b);if(b.length>=4){$("#d_seat").combobox("reload","/common/getUserByUid?uid="+b);$("#d_group").combobox("reload","/common/getAllGroup")}}},onSelect:function(b){$("#d_dept").combobox("setValue",b.department);$("#d_group").combobox("setValue",b.defGrp)}})};function formatItemSeat(a){return a.displayName+"|"+a.userId}var addBlack=function(a){$.ajax({url:"/blackList/addPhoneBlackList",contentType:"application/json",data:{customerId:phone.customerId,customerType:phone.customerType,phoneNum:phone.ani,instId:phone.instId}});$(a).hide()};var callLocalhost=function(a){if(phone.status==7){outphone(phone.ani,"1",phone.instId,phone.customerId,phone.customerType,1)}};var callLongDistance=function(a){if(phone.status==7){boundType=1;outphone(phone.ani,"2",phone.instId,phone.customerId,phone.customerType,1)}};var interrupt=function(a){console.log("interrupt--------"+a);if(a==4||a==6){if($("#callback").val()==1){$("#end").replaceWith('<span id="end" class="end" title="结束会话" ></span>');phone.changeStatus(7)}else{phone.changeStatus(7)}$.ajax({type:"post",url:"/common/phone/interrupt",data:"h_instId="+phone.instId+"&time_length="+phone.seconds+"&ctiedt="+phone.ctiedt+"&connId="+phone.cticonnid,async:false,dataType:"json",success:function(c){try{$("#span_intradayTotalOutcallTime").html(c.totalOutcallTime+"秒")}catch(b){console.info("error")}}})}};var openhookwin=function(){$("#hookMsg").html("");$("#notReadyCode").combobox("setValue","1204");$("#callResult option").eq(0).attr("selected","true");$("#callType option").eq(0).attr("selected","true");$("#h_contactTime").datetimebox({required:false,validType:"istoday[false]"});if(phoneOUT){$("#h_isContact").attr("disabled",true)}else{$("#h_isContact").attr("disabled",false)}$("#content").animate({scrollTop:0},0);$("#warnMsg").html("");if(phone.isOutBoound&&phone.connStates!="Established"){$("#hook").window("open");if($("#seatType").val()=="IN"){$("input[name='hook_st']:eq(2)").attr("checked","checked")}else{$("input[name='hook_st']:eq(1)").attr("checked","checked")}}else{if(hasRecommendedItem()){$("#hook").window("open");if($("#seatType").val()=="IN"){$("input[name='hook_st']:eq(2)").attr("checked","checked")}else{$("input[name='hook_st']:eq(1)").attr("checked","checked")}}else{if(!phone.leadId){$("#hook").window("open");if($("#seatType").val()=="IN"){$("input[name='hook_st']:eq(2)").attr("checked","checked")}else{$("input[name='hook_st']:eq(1)").attr("checked","checked")}}else{recommendMsg("您还没有推荐产品!!","red")}}}};var transferPhone=function(){var a=$("#d_csphone").val();if(a){switch(istransferPhone){case 0:istransferPhone=2;initiateTransfer(a);istransferPhone=0;console.info("电话转接:initiateTransfer");break;case 1:completeTransfer();istransferPhone=0;console.info("完成转接:completeTransfer");break;case 2:$("#transferPhoneBtn").removeClass("retrieve").addClass("icon").attr("title","转接到客服中心");releaseLine2();retrieve();istransferPhone=0;console.info("电话转接:retrieve");break}}};var initNormalPhone=function(){};var normalPhonefilter=function(b,c){var a=c.name+c.paraName;return a.indexOf(b)>=0};var initProvinceCity=function(){console.info("initProvinceCity")};function clearProvinceCity(){$("#prolist").combobox("setValue","");$("#citylist").combobox("setValue","")}function addressfilter(b,c){b=b.toUpperCase();var a=c.value.split(address_split)[0];return a.indexOf(b)>=0}function formatCity(a){return a.areaCode+"|"+a.cityName}function showCtiError(result){var stu=eval("("+result+")");if(stu.errorCode==1140){msgSlide("登陆失败,请重新登陆");if(phone){phone.changeStatus(15)}return}else{if(stu.errorCode==1161){msgSlide("不正确的状态对象");if(phone){if(ctiIsLogIn==0){phone.changeStatus(15);return}}}else{if(stu.errorCode==10116){msgSlide("尚未与CTI建立连接");if(phone){phone.changeStatus(15)}return}else{if(stu.errorCode==10001){msgSlide("请求参数不正确");if(phone){phone.changeStatus(15)}return}else{if(stu.errorCode==1160){}else{if(stu.errorCode==1172){return}else{if(stu.errorCode==1199){msgSlide("话机已签出,请签入")}else{if(stu.errorCode==10101){}else{if(stu.errorCode==1152){return}else{if(stu.errorCode==1172){return}}}}}}}}}}if(ctiIsLogIn==0){if(phone){phone.changeStatus(15)}else{console.info("isInitiate_phone.....")}}else{if(isInitiate==1){console.info("isInitiate.....")}else{msgSlide(stu.message)}}}function ctilogin(){if(checkSoftPhoneApplet()){isSoftPhoneLogin=1;document.location.reload()}}(function(){window.onbeforeunload=function(d){if(!$(".logout").data("isNor")){return"如果离开当前页面所做的修改数据将丢失！"}var c=document.all?true:false;if(c){var f=window.event.screenX-window.screenLeft;var a=f>document.documentElement.scrollWidth-20;if(a&&window.event.clientY<0||window.event.altKey){closeSales();console.info("关闭")}else{console.info("刷新")}}else{if(document.documentElement.scrollWidth!=0&&isSoftPhoneLogin==0){closeSales();console.info("关闭")}else{console.info("刷新")}}}})();function closeSales(){console.info("推出cTI ");agentLogout()}function msgSlide(a){$.messager.show({title:"",msg:a,showType:"slide",style:{right:"",top:document.body.scrollTop+document.documentElement.scrollTop+30,bottom:"",borderTopWidth:0,background:"-webkit-gradient(linear, 0 0, 0 100%, from(#fffcd2), to(#fff8bc))",borderRadius:"0 0 4px 4px"}})}function changeCtiOnAndOff_off(){$("#cti_onAndOff").attr("src","/static/images/phone-lamp-red.png")}function changeCtiOnAndOff_on(){$("#cti_onAndOff").attr("src","/static/images/phone-lamp-gray.png")}function hiddenCtiOnAndOff(){$("#cti_onAndOff").hide()}function isDailSelf(){if(checkSoftPhoneApplet()){if($("#ctiPhoneType").val()==1){if(dailSelf==1){console.info("dailSelf..."+1);msgSlide("系统资源忙,请稍候再试...");return true}}}return false}function bottomLeft(c,b,a,d){$.messager.show({title:c+"【"+b+"】:",msg:"<div style='padding:5px'><span style='font-weight:bold;color:#666;'>"+a+"</span>&nbsp;:&nbsp;"+d+"</div>",showType:"show",timeout:0,style:{borderColor:"#2068b0",backgroundColor:"#2068b0",left:0,right:"",top:"",bottom:23}})}function bottomRight(c,b,a,d){$.messager.defaults={ok:"是",cancel:"否"};$.messager.show({title:c+"【"+b+"】:",msg:"<div style='padding:5px'><span style='font-weight:bold;color:#666;'>"+a+"</span>&nbsp;:&nbsp;"+d+"</div>",showType:"show",timeout:0,style:{borderColor:"#2068b0",backgroundColor:"#2068b0",left:"",right:0,top:"",bottom:23}})}function getAagentLevel(a){if(a){console.info("设置坐席等级:"+a);a=a.substring(a.length-2,a.length);if(a==20){return"A"}else{if(a==15){return"B"}else{if(a==10){return"C"}else{if(a==5){return"D"}else{if(a==1){return"B"}else{return""}}}}}}else{return""}}(function(a){a.fn.capacityFixed=function(b){var d=a.extend({},a.fn.capacityFixed.deflunt,b);var c=function(f){var g=d.top;var e=d.height;f.css({top:g});a("#content").scroll(function(){var h=a(this).scrollTop();if(h>g){if(window.XMLHttpRequest){f.css({position:"fixed",top:30,borderBottom:"3px solid #fff",boxShadow:"0 0 4px rgba(0,0,0,.2)"});f.next().css({marginTop:e})}else{f.css({top:h})}}else{f.css({position:"static",borderBottom:"none",boxShadow:"none"});f.next().css({marginTop:0})}});f.find(".close-ico").click(function(h){f.remove();h.preventDefault()})};return a(this).each(function(){c(a(this))})};a.fn.capacityFixed.deflunt={right:0,top:37,height:33}})(jQuery);function popWin(c,b,a){$("#"+b).remove();$("body").append($("#"+c,parent.document.body).contents().find("#"+b).clone(true));$("document").append($("#"+c,parent.document.body).contents().find("#"+b).clone(true));$("#"+b).window(a).window("open").window("move",{top:($(window).height()-$("#"+b).window("panel").height()-10)*0.5})}function alertWin(b,c){var a={title:b};$("#alertWin").html(c);$("#alertWin").window(a).window("open")}function closeWin(a){$("#"+a).window("close").window("destroy")}function resetApptabsWidth(){var a=$("#apptabs li").length-5;if(a>0){$("#apptabs").width(a*92+350)}}function subCallback(frameId,method){if(!typeof(frameId)=="undefined"||!method){return}if(frameId==""){var paramStr="";for(var i=2;i<arguments.length;i++){if(i>2){paramStr+=","}paramStr+='"'+arguments[i]+'"'}eval(method+"("+paramStr+")")}else{var child=window.frames[frameId];var paramStr="";for(var i=2;i<arguments.length;i++){if(i>2){paramStr+=","}paramStr+='"'+arguments[i]+'"'}if(frameId=="tab_CallbackTab"){eval("p_CallbackTab."+method+"("+paramStr+")")}else{if(child!=null){child.eval(method+"("+paramStr+")")}else{console.debug("null")}}}}function getSubString(b){var a=b;if(a.substring(0,1)=='"'){a=a.substring(1,a.length);a=a.substring(0,a.length-1)}return a}function subContactCallback(b,c){var a="p_"+b;subCallback(a,c)}function detectBrowser(){var a=-1;if($.browser.msie){a=1}if($.browser.mozilla){a=2}if($.browser.chrome){a=3}if($.browser.safari){a=4}if($.browser.opera){a=5}return a}function SetCwinHeight(b){var a=b;if(document.getElementById(a.id)){if(a&&!window.opera){if(a.contentDocument&&a.contentDocument.body.offsetHeight){a.height=a.contentDocument.body.offsetHeight}else{if(a.Document&&a.Document.body.scrollHeight){a.height=a.Document.body.scrollHeight}}}}setPageH(a)}function setPageH(a){$("#scrollWarp").width($(window).width()-448-$("#apptabs").width());setTimeout(function(){$("#center,#right").height("auto");if(a){var c=[parseInt(a.height)+25+33,$("#right").height()];var b=Math.max.apply(null,c);$("#left").height(b-10);$("#right").height(b);$("#center").height(b+5)}},100)}function toggleEv(){$("#fn-bg").bind("click",function(a){$("div.bpoint").toggleClass("on");a.stopPropagation()});$("body").bind("click",function(a){$("div.bpoint").removeClass("on")});$("div.bpoint").click(function(){return false})}var _callBackframeid="";var _callbackMethod="";var _source="";function queryC(b,a,c){_callBackframeid=b;_callbackMethod=a;_source=c;cancleAddressItem();$("#name").val("");$("#phone").val("");$("#findValue").val("");$("#defaultTable").datagrid("loadData",{total:0,rows:[]});$("#defaultTablem").datagrid("loadData",{total:0,rows:[]});if(c=="incomingCall"){$("#queryC").window({close:false})}$("#queryC").window({closable:true,left:($(window).width()-700)/2});$("#queryC").window("open",{type:"fade"})}function queryCustomer(d,b,e,c,a){_callBackframeid=d;_callbackMethod=b;_source=e;$("#name").val("");$("#phone").val("");$("#findValue").val("");$("#defaultTable").datagrid("loadData",{total:0,rows:[]});$("#defaultTablem").datagrid("loadData",{total:0,rows:[]});$("#phone").val(c);if(typeof(a)=="undefined"){$("#queryC").window({closable:false})}else{if(a){$("#queryC").window({closable:true})}else{$("#queryC").window({closable:false})}}$("#queryC").window("open");cancleAddressItem()}var tabsMap=null;var openedContact=new Array();var panelsMap=null;var currentTabObj=null;var currentPanelObj=null;var maxIndex=999;var startId=1;var showccBut=false;function initMain(){tabsMap=new Map();currentPanelObj=createPanel("home","false","/home/home","static");tabsMap.put("home",currentPanelObj);toggleEv();$("#center .tabPage").each(function(){$(this).click(function(){$("#apptabs a").removeClass("current");$("#tabs-active li").removeClass("current");$("#w_combox a").removeClass("sel");$(this).addClass("current");if(this.id=="home"){if(p_home){p_home.window.refreshCampaignGrid(1);p_home.window.refreshAuditGrid(1)}}var c=$(this).attr("id");var a=$(this).attr("url");var b=panelsMap.get(c);currentTabObj=b;if(b==null){closeCurrentPanel();currentPanelObj=createPanel(c,"false",a,"static")}else{closeCurrentPanel();currentPanelObj=b;openCurrentPanel();tabsMap.end(c)}SetCwinHeight(currentPanelObj.dom)})})}function initLeftMenu(){$(".leftMenu").live("click",function(){var d=$(this).attr("id");var a=$(this).attr("name");var c=$(this).text();var b=$(this).attr("multiTab");addTab(d,c,b,a)})}function closeAllTabs(){if(tabsMap){var b=tabsMap.size();var c=tabsMap.list().slice(0);for(var a=0;a<b;a++){if(c[a].value.type=="active"){destoryTab(c[a].key)}}}}function createPanel(c,a,b,d){setPageH();$("#appContent").append('<div><iframe id="p_'+c+'"  name="p_'+c+'" style="width:100%;height:10000px" allowTransparency="true" src='+b+'  frameborder="0"  class="" onload="javascript:SetCwinHeight(this);$(this).focus();"></iframe></div>');var e=new panelObject(c,true,null,d);tabsMap.put(c,e);panelsMap.put(c,e);currentTabObj=e;return e}function addTab(d,f,a,c,e,b){showccBut=false;d=d+"";if(a=="true"){currentTabObj=newTab(d+"_"+(startId++),f,a,c,e,b)}else{if(tabsMap==null){tabsMap=new Map()}currentTabObj=tabsMap.get(d);if(currentTabObj==null){currentTabObj=newTab(d,f,a,c,e,b)}else{var g=panelsMap.get(d);if(g){closeCurrentPanel();currentPanelObj=g;openCurrentPanel()}}}changeTab($("#"+currentTabObj.tabId))}function newTab(tabId,tabName,isNew,url,showCallback,isCloseable){if(tabsMap==null){tabsMap=new Map()}var idx=maxIndex-tabsMap.list().length;$("#w_combox").append('<a for="tab_'+tabId+'">'+tabName+"</a>").parent().addClass("comOn").unbind().bind("click",function(){event.stopPropagation();$(this).addClass("ope");$("#w_combox").show()});$("body").click(function(){$("#w_combox").hide().parent().removeClass("ope")});$("#tabs-active").append('<li  id="tab_'+tabId+'" name='+tabId+' title="'+tabName+'" style="z-index:'+idx+'"><span  class="tab_content"><span>'+tabName+'</span></span><a  class="tab-closeBtn"><span  name="'+tabId+'" class="tab-closeBtn"></span></a></li>');if(typeof(isCloseable)!="undefined"){if(!isCloseable){$("#tab_"+tabId).addClass("rell");$('#w_combox a[for="tab_'+tabId+'"]').css({color:"#007896",textShadow:"rgba(255, 255, 255, 0.8) 0px 0 2px"});showccBut=true}}$("#tabs-active li").removeClass("current");closeCurrentPanel();currentPanelObj=createPanel(tabId,isNew,url,"active");var tab=new panelObject(tabId,true,idx,"active");tabsMap.put(tabId,tab);currentTabObj=tab;$("#tab_"+tabId).click(function(){tabsMap.end(tabId);changeTab($(this));var id=String($(this).attr("name"));var pObj=panelsMap.get(id);if(pObj){closeCurrentPanel();currentPanelObj=pObj;openCurrentPanel()}$("#apptabs a").removeClass("current");$("#tabs-active li").removeClass("current");$(this).addClass("current");SetCwinHeight(currentPanelObj.dom);if(showCallback!=null){var child=window.frames["p_"+tabId];child.eval(showCallback+"()")}});$("#w_combox a[for='tab_"+tabId+"']").click(function(){$("#w_combox a").removeClass("sel");$(this).addClass("sel");$("#tab_"+tabId).click()});$("#apptabs a").removeClass("current");$("#tab_"+tabId+" .tab-closeBtn").click(function(){var tabId=$(this).attr("name");if(tabId){destoryTab(tabId)}});var re=new RegExp("/contact/1/([0-9]*)");if(re.test(url)){openedContact.push(RegExp.$1)}return tab}function changeTab(h){$("#apptabs a,#tabs-active li").removeClass("current");$("#w_combox a").removeClass("sel");if(h!=null){h.addClass("current");$("#w_combox a[for='"+h.attr("id")+"']").addClass("sel")}var b=0;var g=Math.abs(parseInt($("#tabs-active").css("margin-left")));h.prevAll().each(function(){b+=$(this).width()+11});if(b<g){$("#tabs-active").css("margin-left","-"+b+"px")}else{if(g+$("#scrollWarp").width()<b+h.width()+27){$("#tabs-active").css("margin-left","-"+(b+h.width()+30-$("#scrollWarp").width())+"px")}}var f=$("#tabs-active li").length*85;var a=parseInt($("#tabs-active").css("margin-left"));var e=$("#scrollWarp").width();if(a<0&&f>-a+e){$("#l_scroll").addClass("l_on");$("#r_scroll").addClass("r_on")}else{if(a<0&&f<-a+e){$("#l_scroll").addClass("l_on");$("#r_scroll").removeClass("r_on")}else{if(a==0&&f>e){$("#l_scroll").removeClass("l_on");$("#r_scroll").addClass("r_on")}}}}function destoryTab(b){$("#tab_"+b).remove();$("#p_"+b).parent().remove();$("#w_combox a[for='tab_"+b+"']").remove();tabsMap.remove(b);panelsMap.remove(b);var a=tabsMap.last();if(currentTabObj!=null){if(a){$("#"+a.tabId).css("z-index",1000);currentTabObj=a;changeTab($("#"+currentTabObj.tabId));closeCurrentPanel();currentPanelObj=panelsMap.get(a.parentId);openCurrentPanel()}else{currentPanelObj=panelsMap.get("home");changeTab($("#home"));openCurrentPanel();if(p_home){p_home.window.refreshCampaignGrid(1);p_home.window.refreshAuditGrid(1)}try{if(p_mytask){p_mytask.window.refreshCampaignGrid(2);p_mytask.window.refreshAuditGrid(2)}}catch(c){console.info("===========")}$("#w_combox").parent().removeClass("comOn").unbind()}}if($.inArray(b,openedContact)!=-1){openedContact.splice($.inArray(b,openedContact),1)}}function panelObject(d,b,a,c){this.id="p_"+d;this.type=c;if(c=="static"){this.tabId=d}else{if(c=="active"){this.tabId="tab_"+d}}this.parentId=d;this.status=b;this.idx=a;this.dom=document.getElementById(this.id)}function closeCurrentPanel(){if(currentPanelObj!=null){$("#"+currentPanelObj.id).parent().hide()}}function openCurrentPanel(){if(currentPanelObj!=null){$("#"+currentPanelObj.id).parent().show()}SetCwinHeight(currentPanelObj.dom)}function getParentDom(){return window.document}(function(a){a.fn.Scroll=function(b,p){if(!b){var b={}}var o=a("#"+b.left);var q=a("#"+b.right);var k=this.eq(0).find("ul:first");var j=a("#scrollWarp").width();var f=0;var d;var h;function g(){var l=0;k.find("li").each(function(m){l+=a(this).width()+12});d=l;f=parseInt(k.css("margin-left"));h=d-Math.abs(f);if(h-a("#scrollWarp").width()>0&&h-a("#scrollWarp").width()<88){k.animate({"margin-left":f-(h-a("#scrollWarp").width())-10},100,function(){n()})}else{if(h-a("#scrollWarp").width()>88){k.animate({"margin-left":f-85},100,function(){n()})}}}function e(){var l=0;k.find("li").each(function(m){l+=a(this).width()+27});d=l;f=parseInt(k.css("margin-left"));if(Math.abs(f)>0&&Math.abs(f)<88){k.animate({"margin-left":0},100,function(){n()})}else{if(Math.abs(f)>88){k.animate({"margin-left":f+85},100,function(){n()})}}}function c(){k.stop()}function n(){var r=a("#tabs-active li").length*83;var l=parseInt(a("#tabs-active").css("margin-left"));var m=a("#scrollWarp").width();if(l<0&&r>-l+m){a("#l_scroll").addClass("l_on");a("#r_scroll").addClass("r_on")}else{if(l<0&&r<-l+m){a("#l_scroll").addClass("l_on");a("#r_scroll").removeClass("r_on")}else{if(l==0&&r>m){a("#l_scroll").removeClass("l_on");a("#r_scroll").addClass("r_on")}}}}o.bind("click",e);q.bind("click",g)}})(jQuery);$(function(){$(".tabs-warp").capacityFixed();$("#scrollWarp").Scroll({left:"l_scroll",right:"r_scroll"});resetApptabsWidth();$("[aria='true']").focus(function(){$(this).addClass("text-focus")}).blur(function(){$(this).removeClass("text-focus")});$("#handlebarContainer").click(function(){$("#sidebarCell").toggleClass("sidebarCollapsed");window.frames[currentPanelObj.id]._handler()});$("#handlebarContainer2").click(function(){$("#sidebarCell2").toggleClass("sidebarCollapsed");var currentIframe=currentPanelObj.id;window.frames[currentIframe]._handler()});$("#leftPage a").click(function(){setTimeout(function(){SetCwinHeight(currentPanelObj.dom)},1000)});$("#myorder").click(function(){var pObj=panelsMap.get("myorder");if(pObj!=null){var child=window.frames.p_myorder;child.eval("refreshMyorderlist()")}})});function openSms(){addTab("smsTab","短信",false,ctx+"/sms/index")}function openReminder(){document.getElementById("myorder").click()}function openMessage(){addTab("messageTab","消息管理",false,ctx+"/message/index","refreshMessage")}function waitforIframeLoadAndCallback(tabId,funcName,data,count){var child=window.frames["p_"+tabId];if(child!=null){var func=null;try{func=child.eval(funcName)}catch(e){console.debug(e);if(count<5){setTimeout(function(){waitforIframeLoadAndCallback(tabId,funcName,data,count++)},1000)}return}if(func!=null){func(data);return true}}}function showTabAndCallFunc(tabId,funcName,data){var child=window.frames["p_"+tabId];if(child!=null){$('#apptabs a[id="'+tabId+'"]').click();var func=null;try{func=child.eval(funcName)}catch(e){console.debug(e);return false}if(func!=null){func(data);return true}}else{$('#apptabs a[id="'+tabId+'"]').click();setTimeout(function(){waitforIframeLoadAndCallback(tabId,funcName,data,0)},1000);return true}return false}(function(){var a=jQuery.ajax;jQuery.extend({ajax:function(c,b){if(typeof c==="object"){b=c;c=undefined}var d=b.success;b.success=function(f){if(f){if(f.sessionTimeout){console.info("esssionTimeOut..............................................");window.location.href="/login";return}else{try{d.apply(this,arguments)}catch(g){}}}else{try{d.apply(this,arguments)}catch(g){}}};a(c,b)}})})();function banBackSpace(h){var d=h||window.event;var g=d.target||d.srcElement;var c=g.type||g.getAttribute("type");var f=g.getAttribute("readonly");var j=g.getAttribute("enabled");f=(f==null)?false:f;j=(j==null)?true:j;var b=(d.keyCode==8&&(c=="password"||c=="text"||c=="textarea")&&(f==true||j!=true))?true:false;var a=(d.keyCode==8&&c!="password"&&c!="text"&&c!="textarea")?true:false;if(a){return false}if(b){return false}}document.onkeypress=banBackSpace;document.onkeydown=banBackSpace;function addTabClickCallback(tabId,showCallback){if(showCallback!=null){$("#tab_"+tabId).click(function(){var child=window.frames["p_"+tabId];if(child!=null){console.info("inner add call back func!!!");child.eval(showCallback+"()")}})}}function complain(){$("#complain").window("open")}function msgConfirm(c,b,a){$.messager.confirm(c,b,a)}function msgSplash(c,b,a){$.messager.show({title:c,msg:b,timeout:a*1000,showType:"show",style:{position:"center"}})}(function(){$(document).bind("contextmenu",function(){return false});$(document).bind("start",function(){return false});window.onunload=function(){return false};window.onload=function(){window.history.forward(1)};$(document).keydown(function(event){if((event.altKey)&&((event.keyCode==37)||(event.keyCode==39))){event.returnValue=false;return false}if(event.keyCode==8){return banBackSpace(event)}if(event.keyCode==116){return false}if((event.ctrlKey)&&(event.keyCode==82)){return false}});function banBackSpace(e){var ev=e||window.event;var obj=ev.target||ev.srcElement;var t=obj.type||obj.getAttribute("type");var vReadOnly=obj.getAttribute("readonly");var vEnabled=obj.getAttribute("enabled");vReadOnly=(vReadOnly==null)?false:eval(vReadOnly);vEnabled=(vEnabled==null)?true:eval(vEnabled);var flag1=(ev.keyCode==8&&(t=="password"||t=="text"||t=="textarea")&&(vReadOnly==true||vEnabled!=true))?true:false;var flag2=(ev.keyCode==8&&t!="password"&&t!="text"&&t!="textarea")?true:false;if(flag2){return false}if(flag1){return false}}})();$().ready(function(){$("#tbNcfree").combobox({data:[],valueField:"ncfree",textField:"ncfreename",onSelect:function(d){var c=$("#tbNccode").val();var a=$(d).attr("ncfree");var b=$(d).attr("ncfreename");$.post("/inventory/sku",{nccode:c,ncfree:a,ncfreename:b},function(e){if($.isArray(e)&&e.length>0){var f=e[0];if(f!=null){$("#tbPlucode").val($(f).attr("productCode"));$("#tbListPrice").val($(f).attr("listPrice"));if($.isNumeric($(f).attr("groupPrice"))){$("#tbPriceScope").val(Math.min($(f).attr("groupPrice"),$(f).attr("minPrice"))+"-"+Math.max($(f).attr("groupPrice"),$(f).attr("maxPrice")))}else{$("#tbPriceScope").val($(f).attr("minPrice")+"-"+$(f).attr("maxPrice"))}$("#tbStockItem").val($(f).attr("availableQty")+" ("+($(f).attr("status")>=0?"无限制":"按库存销售")+")")}}})}});$("#tbKeyword").focus().autocomplete("/product/search",{minChars:2,max:12,autoFill:false,matchContains:false,matchSubset:false,scrollHeight:260,highlight:function(b,a){return b},parse:function(c){var a=[];if($.isArray(c)){for(var b=0;b<c.length;b++){var d=c[b];if(d){a[a.length]={data:d,value:null,result:this.formatResult&&this.formatResult(d,null)}}}}return a},formatItem:function(c,b,a){return'<span title="'+$(c).attr("spellcode")+'">'+$(c).attr("nccode")+" "+$(c).attr("spellname")+"</span>"},formatResult:function(a){return $(a).attr("nccode")}}).result(function(a,b){if(!b){$("#tbNccode").val("");$("#tbSpellcode").val("");$("#tbSpellname").val("");$("#tbStockItem").val("");$("#tbListPrice").val("");$("#tbPriceScope").val("");$("#tbNcfree").combobox("clear");$("#tbNcfree").combobox("loadData",[]);return}$("#tbNccode").val($(b).attr("nccode"));$("#tbSpellcode").val($(b).attr("spellcode"));$("#tbSpellname").val($(b).attr("spellname"));$("#tbStockItem").val("0");$("#tbListPrice").val($(b).attr("listPrice"));if($.isNumeric($(b).attr("groupPrice"))){$("#tbPriceScope").val(Math.min($(b).attr("groupPrice"),$(b).attr("minPrice"))+"-"+Math.max($(b).attr("groupPrice"),$(b).attr("maxPrice")))}else{if($(b).attr("minPrice")&&$(b).attr("maxPrice")){$("#tbPriceScope").val($(b).attr("minPrice")+"-"+$(b).attr("maxPrice"))}else{$("#tbPriceScope").val("0-0")}}$("#tbNcfree").combobox("clear");$("#tbNcfree").combobox("loadData",[]);$.post("/product/attributes",{nccode:$(b).attr("nccode")},function(c){$("#tbNcfree").combobox("clear");if($.isArray(c)&&c.length>0){$("#tbNcfree").combobox("loadData",c)}else{$("#tbNcfree").combobox("loadData",[])}});$.post("/inventory/item",{nccode:$(b).attr("nccode"),instId:getRecommandTaskId()},function(c){if($.isArray(c)&&c.length>0){$("#tbStockItem").val($(c[0]).attr("availableQty")+" ("+($(c[0]).attr("status")>=0?"无限制":"按库存销售")+")")}});$.post("/product/discourse",{nccode:$(b).attr("nccode")},function(d){var c=$(d).attr("discourseHtmlContent");$("#lblDiscourseInfo").html(c?c:"没有找到任何信息！")});if(appendRecommendItem&&$(b).attr("nccode")){appendRecommendItem($(b).attr("nccode"),$(b).attr("spellname"),false)}});$("#lnkStockItem").click(function(){var c=$("#tbNccode").val();if(c){var a=$("#tbNcfree").combobox("getValue");var b=$("#tbNcfree").combobox("getText");$.post("/warehouse/sku",{nccode:c,ncfree:a,ncfreename:b},function(d){$("#dgStockItem").datagrid("loadData",d);$("#dlgStockItem").window("open")})}else{window.parent.alertWin("系统提示","请先指定产品")}});$("#dlgStockItem").window({title:"商品库存明细",width:750,height:500,modal:true,shadow:false,collapsible:false,minimizable:false,maximizable:false,closed:true,draggable:false});$("#dgStockItem").datagrid({title:"",iconCls:"icon-edit",width:"100%",height:400,striped:true,border:true,scrollbarSize:16,collapsible:true,fitColumns:true,fit:true,idField:"productId",columns:[[{field:"productCode",title:"产品编码",width:100,editor:"text"},{field:"productName",title:"产品名称",width:100,editor:"text"},{field:"spellCode",title:"产品简码",width:120,editor:"text"},{field:"spellName",title:"产品简称",width:120,editor:"text",hidden:true},{field:"ncfree",title:"规格编码",width:120,editor:"text",hidden:true},{field:"ncfreeName",title:"规格名称",width:120,editor:"text"},{field:"warehouse",title:"仓库名称",width:120,editor:"text",hidden:true},{field:"warehouseName",title:"仓库名称",width:120,editor:"text"},{field:"onHandQty",title:"在库量",width:120,editor:"text",hidden:true},{field:"availableQty",title:"可用量",width:120,editor:"text"},{field:"status",title:"备注",width:120,editor:"text",formatter:function(a){return a=="-1"?"按库存销售":"无限制"}}]],remoteSort:false,singleSelect:true,checkOnSelect:false,selectOnCheck:false,pagination:false,rownumbers:false,onLoadSuccess:function(a){$(this).parent().find(".datagrid-btable").tableGroup({sumColumn:10,groupColumn:1,groupClass:"panel-header"})},onLoadError:function(){window.parent.alertWin("系统提示","加载失败!")}});$("#lnkAddFavorite").click(function(){var c=$("#tbNccode").val();if(c){var a=$("#tbNcfree").combobox("getValue");var b=$("#tbNcfree").combobox("getText");$.post("/inventory/addFavorite",{nccode:c,ncfree:a,ncfreename:b},function(d){window.parent.alertWin("系统提示",d);if(d.indexOf("成功")>-1){var e=window.frames.p_inventory;if(e){e.location.reload()}}},"text")}else{window.parent.alertWin("系统提示","添加收藏前，请先搜索出相关商品");$("#tbKeyword").focus()}})});function addCallbackProduct(){var a=window.frames.p_CallbackTab;if(a){if($(a).parent("div:visible")){if(a.addCallbackProduct){a.addCallbackProduct($("#tbNccode").val(),$("#tbSpellcode").val());return true}}}return false}function addShoppingCartProduct(){if(!addCallbackProduct()){var _currentPanel=$("#content").find("#center").find(".current").attr("id");if(_currentPanel){var _currentFrameId=_currentPanel.replace("tab_","p_");if(!$("#tbNccode").val()){window.parent.alertWin("系统提示","请输入加入购物车的产品");return}var options=$("#tbNcfree").combobox("getData").length;if(options>0&&!$("#tbNcfree").combobox("getValue")){window.parent.alertWin("系统提示","请选择加入购物车的产品规格");return}var child=window.frames[_currentFrameId];child.eval('addProduct("'+$("#tbNccode").val()+'","'+$("#tbNcfree").combobox("getText")+'","'+$("#tbListPrice").val()+'")')}}}$().ready(function(){$("#recommend-button").click(function(){var a=$("#recommend-button").attr("instId");if(a){var c=$("input[name='item-recomment']:checked").map(function(){return $(this).val()}).get().join(",");var b=$("#recommend-button").attr("tollFreeNum");var d=$("#recommend-button").attr("campainId");$.ajax({type:"POST",url:"/product/recommend/submit",data:{instId:a,tollFreeNum:b,campainId:d,nccodes:c},beforeSend:function(){recommendMsg("","",true)},success:function(e){if(e.indexOf("失败")>-1){recommendMsg(e,"red",false)}else{recommendMsg(e,"blue",false)}},dataType:"text"})}else{recommendMsg("还没有创建任务","red",false)}})});function clearRecommendItems(){$("#recommend-container").empty()}function search(a){$("#tbKeyword").val(a);$("#tbKeyword").search()}function incomingCall(a){clearRecommendItems();$.post("/product/recommend/incoming",{campainId:phone.campainId,tollFreeNum:a},function(c){$("#recommend-title").text("("+c.name+")").attr("title",c.name).show();if($.isArray(c.details)){for(var b=0;b<c.details.length;b++){var d=c.details[b];if(d){appendRecommendItem($(d).attr("nccode"),$(d).attr("spellname"),true)}}}})}function outgoingCall(b,a){clearRecommendItems();$("#recommend-button").attr("instId",a);$("#recommend-button").attr("campainId",b);$("#recommend-button").attr("tollFreeNum","");$("#recommend-button").attr("sourceType","");$.get("/task/querySourceType",{instId:a},function(c){$("#recommend-button").attr("sourceType",c)});$.post("/product/recommend/outgoing",{campainId:b,instId:a},function(d){$("#recommend-title").text("("+d.name+")").attr("title",d.name).show();if($.isArray(d.details)){for(var c=0;c<d.details.length;c++){var e=d.details[c];if(e){appendRecommendItem($(e).attr("nccode"),$(e).attr("spellname"),true)}}}})}function appendRecommendItem(e,d,b){if(b){$("#recommend-container").append("<p id='recommend-custom-item'><input class='checkbox fl' onchange='return changeItem(this)' name='item-recomment' type='checkbox' value='"+e+"' /><a href =\"javascript:search('"+e+"');\" title='"+d+"'>"+d+"</a></p>")}else{var a=$("#recommend-button").attr("instId");if(a){var c=$("input[name='item-recomment']").map(function(){return $(this).val()}).get();if($.inArray(e,c)==-1){$("#recommend-container-item").remove();$("#recommend-container").append("<p id='recommend-container-item'><input class='checkbox fl' onchange='return changeItem(this)' name='item-recomment' type='checkbox' value='"+e+"' /><a href =\"javascript:search('"+e+"');\" title='"+d+"'>"+d+"</a></p>")}}}}function changeItem(b){$("#recommend-button").click();var a=$("#recommend-button").attr("instId");if(a){$(b).attr("disabled","disabled")}else{$(b).removeAttr("checked")}return a}function hasRecommendedItem(){if($("#recommend-button").attr("sourceType")=="5"){return true}var a=$("input[name='item-recomment']:checked").map(function(){return $(this).val()}).get();if(a&&a.length>0){return true}else{a=$("input[name='item-recomment']").map(function(){return $(this).val()}).get();if(a.length>1){return false}else{if(a.length==0){return true}else{if($("#recommend-container").has("#recommend-custom-item")){return true}}}return false}}function recommendMsg(c,a,b){if($.contains("#recommend-wrap","div.tips")){$("#recommend-wrap").show()}else{$("#recommend-wrap").append('<div class="tips" ></div>')}if(b){$("#recommend-container div.c_mask").html('<img src="static/images/loading.gif">')}else{$("#recommend-wrap div.tips").html("<span >"+c+"</span>")}$("#recommend-wrap div.tips").fadeOut(2000)}function showIncomingCall(){window.queryC(frameElement.id,"returnIncomingCall","incomingCall")}function returnIncomingCall(c,b,d,a){createRecommendTask(c,b,d,a)}function createRecommendTask(c,b,e,a,d){$("#recommend-button").attr("tollFreeNum",c);$("#recommend-button").attr("telephone",b);$("#recommend-button").attr("sourceType",$("#callback").attr("value")=="1"?"4":"0");$.post("/product/recommend/lead",{tollFreeNum:c,telephone:b,leadId:d,contactId:e,contactType:a,sourceType:$("#recommend-button").attr("sourceType"),cticonnid:phone.cticonnid,begindate:phone.ctisdt,acdgroup:phone.acdId,callback:$("#callback").attr("value")=="1",campainId:phone.campainId},function(f){f=$.isPlainObject(f)?f:$.parseJSON(f);if(f){if(f.errorMsg){window.parent.alertWin("系统提示",f.errorMsg)}else{phone.instId=f.instId;phone.leadId=f.leadId;phone.leadInterId=f.leadInterId;$("#recommend-button").attr("instId",f.instId)}}},"json")}function getRecommandTaskId(){return $("#recommend-button").attr("instId")}function createRecommendTaskCallback(b,a){$("#recommend-button").attr("tollFreeNum",phone.dnsi);$("#recommend-button").attr("telephone",phone.ani);$("#recommend-button").attr("sourceType",a=="1"?"4":"0");$.post("/product/recommend/lead",{tollFreeNum:phone.dnsi,telephone:phone.ani,leadId:phone.leadId,contactId:b,contactType:phone.customerType,sourceType:a=="1"?"4":"0",cticonnid:phone.cticonnid,begindate:phone.ctisdt,acdgroup:phone.acdId,callback:$("#callback").attr("value")=="1",campainId:phone.campainId},function(c){c=$.isPlainObject(c)?c:$.parseJSON(c);if(c){if(c.errorMsg){window.parent.alertWin("系统提示",c.errorMsg)}else{phone.instId=c.instId;phone.leadId=c.leadId;phone.leadInterId=c.leadInterId;$("#recommend-button").attr("instId",c.instId)}}},"json")}function Map(){var c=function(k,l){this.key=k;this.value=l};var f=function(l,m){for(var k=0;k<this.arr.length;k++){if(this.arr[k].key===l){this.arr[k].value=m;return}}this.arr[this.arr.length]=new c(l,m)};var a=function(l){for(var k=0;k<this.arr.length;k++){if(this.arr[k].key===l){return this.arr[k].value}}return null};var e=function(m){var k;for(var l=0;l<this.arr.length;l++){k=this.arr[l];if(k.key===m){this.arr.splice(l,1)}}};var j=function(){return this.arr.length};var d=function(){return this.arr.length<=0};var g=function(){return this.arr};var h=function(){if(this.arr.length>0){return this.arr[this.arr.length-1].value}return null};var b=function(n){var l,k;for(var m=0;m<this.arr.length;m++){l=this.arr[m];if(l.key===n){k=this.arr.splice(m,1)[0];this.arr.push(k)}}};this.arr=new Array();this.get=a;this.put=f;this.remove=e;this.size=j;this.isEmpty=d;this.list=g;this.last=h;this.end=b}var old_customerId="",old_customerType="";var taskId;function findCustomer(){var b=$("#phone").val();if("queryByPhone"==_source){$("#phone").val("")}$("#defaultTable").datagrid({title:"",iconCls:"icon-edit",height:200,nowrap:false,striped:true,border:true,collapsible:false,fitColumns:true,scrollbarSize:-1,url:"/customer/mycustomer/find",idField:"contactid",sortName:"crdt",sortOrder:"desc",columns:[[{field:"customerId",title:"客户编号",align:"center",width:100},{field:"name",title:"客户名称",align:"center",width:80},{field:"level",title:"会员等级",align:"center",width:80},{field:"address",title:"客户地址",width:200},{field:"detailedAddress",title:"详细地址",width:100,formatter:function(d,c,e){if(d==null||d==""){return""}return"<div unselectable='on' onselectstart='return false;' style='-moz-user-select:none;'><marquee scrollamount='3'>"+d+"</marquee></div>"}},{field:"crusr",title:"创建人",align:"center",width:80},{field:"crdt",title:"创建时间",width:140},{field:"sex",title:"性别",width:100,hidden:true},{field:"addressid",title:"地址编号",width:100,hidden:true},{field:"customerType",title:"客户类别",width:100,formatter:function(d,c,e){if(d=="2"){return"潜在客户"}else{if(d=="1"){return"正式客户"}}}}]],remoteSort:false,singleSelect:false,pagination:true,queryParams:{phone:b,name:$("#name").val(),province:$("#province").combobox("getValue"),cityId:$("#cityId").combobox("getValue"),countyId:$("#countyId").combobox("getValue"),areaId:$("#areaId").combobox("getValue")},onDblClickRow:function(d,e){if(e){if(typeof(_source)=="undefined"){gotoInfoCustomer(e.customerId,e.customerType,typeof(e.name)=="undefined"?e.customerId:e.name)}else{if(_source=="shoppingCart"){subCallback(_callBackframeid,_callbackMethod,e.customerId,typeof(e.name)=="undefined"?e.customerId:e.name)}else{if(_source=="editOrder"){subCallback(_callBackframeid,_callbackMethod,e.customerId,typeof(e.name)=="undefined"?e.customerId:e.name)}else{if(_source=="createComplain"){if(e.customerType=="1"){subCallback(_callBackframeid,_callbackMethod,e.customerId,typeof(e.name)=="undefined"?e.customerId:e.name)}}else{if(_source=="incomingCall"){isCloseFindC=false;phone.customerType=e.customerType;phone.customerId=e.customerId;subCallback(_callBackframeid,_callbackMethod,e.customerId);if($("#callback").val()==1){gotoInfoCallBack(e.customerId,e.customerType,typeof(e.name)=="undefined"?e.customerId:e.name,false)}else{gotoInfoCustomer(e.customerId,e.customerType,typeof(e.name)=="undefined"?e.customerId:e.name,false)}}else{if(_source=="changeCC"){if(old_customerId==e.customerId&&old_customerType==e.customerType){alertWin("系统提示","请选择不同的联系人")}else{phone.customerType=e.customerType;phone.customerId=e.customerId;closeAllTabs();gotoInfoCustomer(e.customerId,e.customerType,typeof(e.name)=="undefined"?e.customerId:e.name,false);subCallback(_callBackframeid,_callbackMethod)}}else{if(_source=="callback"){subCallback(_callBackframeid,_callbackMethod,e.customerId,e.customerType,e.name,e.sex)}else{if(_source="outCall"){phone.customerType=e.customerType;phone.customerId=e.customerId;gotoInfoCustomer(e.customerId,e.customerType,typeof(e.name)=="undefined"?e.customerId:e.name);var c=true;if(e.customerType=="2"){c=false}relateContactWithTask(e.customerId,taskId,c);taskId="";_source=""}}}}}}}}$("#queryC").window("close")}}});var a=$("#defaultTable").datagrid("getPager");$(a).pagination({pageSize:10,pageList:[5,10,15],beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"当前显示 {from} - {to} 条记录   共 {total} 条记录",onBeforeRefresh:function(){$(this).pagination("loading");$(this).pagination("loaded")}})}function cancleCustomer(){$("#phone").attr("value","");$("#name").attr("value","");cancleAddressItem();$("#defaultTable").datagrid("load")}function addCustomer(){$("#queryC").window("close");gotoAddCustomer()}function findCustomerm(){$("#defaultTablem").datagrid({title:"",iconCls:"icon-edit",height:292,nowrap:true,striped:true,border:false,collapsible:false,fitColumns:true,scrollbarSize:-1,url:"/customer/mycustomer/more/find",idField:"customerId",sortName:"crdt",sortOrder:"desc",columns:[[{field:"customerId",title:"客户编号",width:100},{field:"name",title:"客户名称",width:80},{field:"level",title:"会员等级",width:80,align:"right"},{field:"address",title:"客户地址",width:200,align:"right"},{field:"detailedAddress",title:"详细地址",width:100,align:"right",formatter:function(c,b,d){if(c==null||c==""){return""}return"<div unselectable='on' onselectstart='return false;' style='-moz-user-select:none;'><marquee scrollamount='3'>"+c+"</marquee></div>"}},{field:"crusr",title:"创建人",width:100,align:"right"},{field:"crdt",title:"创建时间",width:140,align:"right"},{field:"sex",title:"性别",width:100,hidden:true},{field:"addressid",title:"地址编号",width:100,hidden:true},{field:"customerType",title:"客户类别",width:100,formatter:function(c,b,d){if(c=="2"){return"潜在客户"}else{if(c="1"){return"正式客户"}}}}]],remoteSort:false,singleSelect:false,pagination:true,queryParams:{typeValue:$("#typeValue").val(),findValue:$.trim($("#findValue").val())},onDblClickRow:function(c,d){if(d){if(typeof(_source)=="undefined"){gotoInfoCustomer(d.customerId,d.customerType,typeof(d.name)=="undefined"?d.customerId:d.name)}else{if(_source=="shoppingCart"){subCallback(_callBackframeid,_callbackMethod,d.customerId,typeof(d.name)=="undefined"?d.customerId:d.name)}else{if(_source=="editOrder"){subCallback(_callBackframeid,_callbackMethod,d.customerId,typeof(d.name)=="undefined"?d.customerId:d.name)}else{if(_source=="incomingCall"){isCloseFindC=false;phone.customerType=d.customerType;phone.customerId=d.customerId;if(old_customerId){subCallback(_callBackframeid,_callbackMethod,d.customerId)}if($("#callback").val()==1){gotoInfoCallBack(d.customerId,d.customerType,typeof(d.name)=="undefined"?d.customerId:d.name,false)}else{gotoInfoCustomer(d.customerId,d.customerType,typeof(d.name)=="undefined"?d.customerId:d.name,false)}}else{if(_source=="createComplain"){if(d.customerType=="1"){subCallback(_callBackframeid,_callbackMethod,d.customerId,typeof(d.name)=="undefined"?d.customerId:d.name)}}else{if(_source=="changeCC"){phone.customerType=d.customerType;phone.customerId=d.customerId;closeAllTabs();gotoInfoCustomer(d.customerId,d.customerType,typeof(d.name)=="undefined"?d.customerId:d.name,false);subCallback(_callBackframeid,_callbackMethod)}else{if(_source=="callback"){subCallback(_callBackframeid,_callbackMethod,d.customerId,d.customerType,d.name,d.sex)}else{if(_source="outCall"){phone.customerType=d.customerType;phone.customerId=d.customerId;gotoInfoCustomer(d.customerId,d.customerType,typeof(d.name)=="undefined"?d.customerId:d.name);var b=true;if(d.customerType=="2"){b=false}relateContactWithTask(d.customerId,taskId,b);taskId=""}}}}}}}}$("#queryC").window("close")}}});var a=$("#defaultTablem").datagrid("getPager");$(a).pagination({pageSize:10,pageList:[5,10,15],beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"当前显示 {from} - {to} 条记录   共 {total} 条记录",onBeforeRefresh:function(){$(this).pagination("loading");$(this).pagination("loaded")}})}function cancleCustomerm(){$("#findValue").attr("value","");$("#defaultTablem").datagrid("load")}function addCustomerm(){$("#queryC").window("close");gotoAddCustomer()}function saveFindToSession(a){$.post("/customer/mycustomer/save/find",{customerId:a},function(b){window.parent.alertWin("系统提示",b.result);$("#queryC").window("close")})}function gotoAddCustomer(){if((_source=="incomingCall"&&isCloseFindC)||_source=="callback"){$.post("/customer/mycustomer/potentialContact/add",{phn1:phone1,phn2:phone2,phn3:phone3,phonetype:phoneType},function(e){if(e.result){phone.customerId=e.potentialContactId;phone.customerType="2";if($("#callback").val()==1){gotoInfoCallBack(e.potentialContactId,2,phone.ani,false)}else{gotoInfoCustomer(e.potentialContactId,2,phone.ani,false)}createRecommendTask(phone.dnsi,phone.ani,e.potentialContactId,"2")}else{window.parent.alertWin("系统提示",e.msg)}})}else{var d="newCustomer";var a="/inbound/inbound";var c="新建客户";var b=false;addTab(d,c,b,a)}}function gotoInfoCustomer(g,d,c,a){var b="/contact/"+d+"/"+g+"?provid="+$("#d_provid").val()+"&cityid="+$("#d_cityid").val();var f=c+"-详细信息";var e=false;addTab(g,f,e,b,null,a);$("#d_provid").val("");$("#d_cityid").val("")}function gotoInfoCallBack(h,d,c,a){var b="/callback/callback/"+d+"/"+h;var g="CallBack";var e=false;var f=window.frames.tab_CallbackTab;if(typeof(f)=="undefined"){addTab("CallbackTab",g,e,b,null,a)}else{destoryTab("CallbackTab");console.info("================================================");addTab("CallbackTab",g,e,b,null,a);console.info("==================================================++++")}}function relateContactWithTask(d,c,a){var b="/task/updateContact?instId="+c+"&contactId="+d+"&isPotential="+a;$.ajax({url:b})}function callBack_product(){}function cc_change(b,a){old_customerId=b;old_customerType=a;queryCustomer("","cc_change_callback","changeCC",phone.ani,true);findCustomer()}function cc_change_callback(){$.post("/common/changeCC",{customerId:phone.customerId,customerType:phone.customerType,instId:phone.instId},function(a){if(!a.result){}})}var _callbackFrameId="";function popConfirm(e,c,b){_callbackFrameId=e;$("#"+c).remove();if($("#"+c).length==0){var a=$("body");var d=$("#"+e,parent.document.body).contents();$("body").append($("#"+e,parent.document.body).contents().find("#"+c).clone(true))}$("#"+c).window(b).window("refresh").window("open").window("move",{top:($(window).height()-$("#"+c).window("panel").height()-10)*0.5});$("#"+c).window("setTitle",b.title)}function popAlert(f,h){var g=$(document).scrollTop();var c=$(window).height();var b=$(window).width();var a=(c-90)/2+g;var e=(b-400)/2;var d={title:f,top:a,left:e};$("#alertWin").html(h);$("#alertWin").window(d).window("open").window("move",{top:($(window).height()-$("#alertWin").window("panel").height()+10)*0.5})}function closeWin(a){$("#"+a).window("close").window("destroy")}function callRelatedConfirm(a){subCallback(_callbackFrameId,"relatedConfirm",a)}function relatedCallback(b,a){subCallback(_callbackFrameId,a,b)}function openAudit(b,a,d){var c="task/processAuditTaskAjax?batchId="+b+"&auditTaskType="+d+"&isConfirmAudit=0&id="+a;window.parent.addTab("task_"+b,"我的订单","false",c);$("#alertWin").html("");$("#alertWin").window("close")}function openOrder(a,c){var b="myorder/orderDetails/get/"+a+"?activable=false";window.parent.addTab("myorder_"+a,"订单："+a,"false",b);closeWin("id_related_"+c);closeWin("id_edit_comfirm_div_"+c)};