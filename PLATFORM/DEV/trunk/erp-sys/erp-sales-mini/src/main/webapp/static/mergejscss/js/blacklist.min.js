$(document).ready(function(){$("#blackPhoneTable").datagrid({view:detailview,detailFormatter:function(a,b){return'<table style="" id="ddv-'+a+'"></table>'},onExpandRow:function(a,b){$("#ddv-"+a).datagrid({fitColumns:true,singleSelect:true,scrollbarSize:-1,loadMsg:"",columns:[[{field:"potentialContactId",title:"客户编号",width:100,align:"center",formatter:function(d,c){if(d==null){return c.contactId}else{return d}}},{field:"createUser",title:"坐席工号",width:200,align:"center"},{field:"createDate",title:"加黑申请时间",width:100,align:"center",formatter:dateFormatter},{field:"createUserGrp",title:"坐席组",width:100,align:"center"}]],onResize:function(){},onLoadSuccess:function(){setTimeout(function(){$("#blackPhoneTable").datagrid("fixDetailRowHeight",a)},200)}});$("#ddv-"+a).datagrid("loadData",{total:b.blackLists.length,rows:b.blackLists})},width:"100%",height:410,scrollbarSize:-1,fitColumns:true,columns:[[{field:"phoneNum",title:"电话",align:"center",width:60},{field:"addTimes",title:"加黑申请次数",align:"center",width:40},{field:"approveManager",title:"操作人",align:"center",width:40},{field:"approveDate",title:"操作时间",align:"center",width:120,formatter:dateFormatter},{field:"status",title:"状态",align:"center",width:80,formatter:orderStatusFormatter},{field:"action",title:"操作",width:80,align:"center",formatter:function(b,a){if(a.status==1){return'<div class="orderInfo_btns"><a class="add" href="javascript:void(0)" onclick="toggleBlackPhone('+a.status+", "+a.blackPhoneId+')" >加黑</a></div>'}if(a.status==2){return'<div class="orderInfo_btns"><a class="add" href="javascript:void(0)" onclick="toggleBlackPhone('+a.status+", "+a.blackPhoneId+')" >去黑</a></div>'}}}]],remoteSort:false,singleSelect:true,pagination:true,onLoadSuccess:function(a){if(a.err!=null){window.parent.alertWin("系统提示",a.err)}},onLoadError:function(){window.parent.alertWin("系统提示","加载失败")}});$("#messagesearch").bind("click",function(){$("#blackPhoneTable").datagrid({url:"/blackList/query",queryParams:{phoneNum:$.trim($("#phoneNum").val()),addTimes:$.trim($("#addTimes").val()),status:$("#status").val()}})});$("#messagereset").bind("click",function(){$("#phoneNum").val("");$("#addTimes").val("");$("#status").val("")})});function orderStatusFormatter(b){var a="";if(b==1){a="未加黑"}else{if(b==2){a='<span style="color:red;">已加黑</span>'}else{if(b==3){a="已去黑"}}}return a}function dateFormatter(a){if(null!=a){return new Date(a).format("yyyy-MM-dd hh:mm:ss")}}Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};function toggleBlackPhone(a,b){if(a==1){$.ajax({url:"/blackList/addToBlackPhone/"+b,contentType:"application/json",success:function(c){if(c){$("#blackPhoneTable").datagrid("reload")}else{window.parent.alertWin("系统提示","加入黑名单失败")}}})}else{$.ajax({url:"/blackList/removeFromBlackPhone/"+b,contentType:"application/json",success:function(c){if(c){$("#blackPhoneTable").datagrid("reload")}else{window.parent.alertWin("系统提示","移除黑名单失败")}}})}};