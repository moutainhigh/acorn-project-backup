var detailview=$.extend({},$.fn.datagrid.defaults.view,{render:function(l,e,a){var d=$.data(l,"datagrid");var b=d.options;if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var p=d.data.rows;var k=$(l).datagrid("getColumnFields",a);var n=[];n.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var h=0;h<p.length;h++){var j=b.rowStyler?b.rowStyler.call(l,h,p[h]):"";var f="";var o="";if(typeof j=="string"){o=j}else{if(j){f=j["class"]||"";o=j.style||""}}var m='class="datagrid-row '+(h%2&&b.striped?"datagrid-row-alt ":" ")+f+'"';var c=o?'style="'+o+'"':"";var g=d.rowIdPrefix+"-"+(a?1:2)+"-"+h;n.push('<tr id="'+g+'" datagrid-row-index="'+h+'" '+m+" "+c+">");n.push(this.renderRow.call(this,l,k,a,h,p[h]));n.push("</tr>");n.push('<tr style="display:none;">');if(a){n.push("<td colspan="+(k.length+2)+' style="border-right:0">')}else{n.push("<td colspan="+(k.length)+">")}n.push('<div class="datagrid-row-detail">');if(a){n.push("&nbsp;")}else{n.push(b.detailFormatter.call(l,h,p[h]))}n.push("</div>");n.push("</td>");n.push("</tr>")}n.push("</tbody></table>");$(e).html(n.join(""))},renderRow:function(m,l,a,n,h){var b=$.data(m,"datagrid").options;var g=[];if(a&&b.rownumbers){var f=n+1;if(b.pagination){f+=(b.pageNumber-1)*b.pageSize}g.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+f+"</div></td>")}for(var j=0;j<l.length;j++){var o=l[j];var e=$(m).datagrid("getColumnOption",o);if(e){var p=h[o];var k=e.styler?(e.styler(p,h,n)||""):"";var d="";var r="";if(typeof k=="string"){r=k}else{if(g){d=k["class"]||"";r=k.style||""}}var q=d?'class="'+d+'"':"";var c=e.hidden?'style="display:none;'+r+'"':(r?'style="'+r+'"':"");g.push('<td field="'+o+'" '+q+" "+c+">");if(e.checkbox){c=""}else{if(e.expander){c="text-align:center;height:16px;"}else{c=r;if(e.align){c+=";text-align:"+e.align+";"}if(!b.nowrap){c+=";white-space:normal;height:auto;"}else{if(b.autoRowHeight){c+=";height:auto;"}}}}g.push('<div style="'+c+'" ');if(e.checkbox){g.push('class="datagrid-cell-check ')}else{g.push('class="datagrid-cell '+e.cellClass)}g.push('">');if(e.checkbox){g.push('<input type="checkbox" name="'+o+'" value="'+(p!=undefined?p:"")+'">')}else{if(e.expander){g.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />')}else{if(e.formatter){g.push(e.formatter(p,h,n))}else{g.push(p)}}}g.push("</div>");g.push("</td>")}}return g.join("")},insertRow:function(f,e,k){var a=$.data(f,"datagrid").options;var j=$.data(f,"datagrid").dc;var b=$(f).datagrid("getPanel");var i=j.view1;var g=j.view2;var h=false;var c=$(f).datagrid("getRows").length;if(c==0){$(f).datagrid("loadData",{total:1,rows:[k]});return}if(e==undefined||e==null||e>=c){e=c;h=true;this.canUpdateDetail=false}$.fn.datagrid.defaults.view.insertRow.call(this,f,e,k);d(true);d(false);this.canUpdateDetail=true;function d(o){var l=o?i:g;var n=l.find("tr[datagrid-row-index="+e+"]");if(h){var m=n.next().clone()}else{var m=n.next().next().clone()}m.insertAfter(n);m.hide();if(!o){m.find("div.datagrid-row-detail").html(a.detailFormatter.call(f,e,k))}}},deleteRow:function(e,b){var c=$.data(e,"datagrid").options;var a=$.data(e,"datagrid").dc;var d=c.finder.getTr(e,b);d.next().remove();$.fn.datagrid.defaults.view.deleteRow.call(this,e,b);a.body2.triggerHandler("scroll")},updateRow:function(e,g,f){var b=$.data(e,"datagrid").dc;var d=$.data(e,"datagrid").options;var a=$(e).datagrid("getExpander",g).attr("class");$.fn.datagrid.defaults.view.updateRow.call(this,e,g,f);$(e).datagrid("getExpander",g).attr("class",a);if(this.canUpdateDetail){var f=$(e).datagrid("getRows")[g];var c=$(e).datagrid("getRowDetail",g);c.html(d.detailFormatter.call(e,g,f))}},bindEvents:function(e){var d=$.data(e,"datagrid");var b=d.dc;var c=d.options;var a=b.body1.add(b.body2);var f=($.data(a[0],"events")||$._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(i){var g=$(i.target);var h=g.closest("tr.datagrid-row");if(!h.length){return}if(g.hasClass("datagrid-row-expander")){var j=parseInt(h.attr("datagrid-row-index"));if(g.hasClass("datagrid-row-expand")){$(e).datagrid("expandRow",j)}else{$(e).datagrid("collapseRow",j)}$(e).datagrid("fixRowHeight")}else{f(i)}i.stopPropagation()})},onBeforeRender:function(h){var b=$.data(h,"datagrid");var a=b.options;var j=b.dc;var k=$(h);var l=false;var f=k.datagrid("getColumnFields",true).concat(k.datagrid("getColumnFields"));for(var e=0;e<f.length;e++){var c=k.datagrid("getColumnOption",f[e]);if(c.expander){l=true;break}}if(!l){if(a.frozenColumns&&a.frozenColumns.length){a.frozenColumns[0].splice(0,0,{field:"_expander",expander:true,width:24,resizable:false,fixed:true})}else{a.frozenColumns=[[{field:"_expander",expander:true,width:24,resizable:false,fixed:true}]]}var k=j.view1.children("div.datagrid-header").find("table");var d=$('<td rowspan="'+a.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>');if($("tr",k).length==0){d.wrap("<tr></tr>").parent().appendTo($("tbody",k))}else{if(a.rownumbers){d.insertAfter(k.find("td:has(div.datagrid-header-rownumber)"))}else{d.prependTo(k.find("tr:first"))}}}var g=this;setTimeout(function(){g.bindEvents(h)},0)},onAfterRender:function(g){var e=this;var f=$.data(g,"datagrid");var c=f.dc;var d=f.options;var b=$(g).datagrid("getPanel");$.fn.datagrid.defaults.view.onAfterRender.call(this,g);if(!f.onResizeColumn){f.onResizeColumn=d.onResizeColumn}if(!f.onResize){f.onResize=d.onResize}function a(){var h=c.view2.children("div.datagrid-header").find("table").width();c.body2.children("table").width(h)}d.onResizeColumn=function(l,k){a();var h=$(g).datagrid("getRows").length;for(var j=0;j<h;j++){$(g).datagrid("fixDetailRowHeight",j)}f.onResizeColumn.call(g,l,k)};d.onResize=function(i,h){a();f.onResize.call(b,i,h)};this.canUpdateDetail=true;c.footer1.find("span.datagrid-row-expander").css("visibility","hidden");$(g).datagrid("resize")}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(b,a){return b.each(function(){var f=$.data(this,"datagrid").options;if(!(f.rownumbers||(f.frozenColumns&&f.frozenColumns.length))){return}var e=$.data(this,"datagrid").dc;var d=f.finder.getTr(this,a,"body",1).next();var g=f.finder.getTr(this,a,"body",2).next();if(g.is(":visible")){d.css("height","");g.css("height","");var c=Math.max(d.height(),g.height());d.css("height",c);g.css("height",c)}e.body2.triggerHandler("scroll")})},getExpander:function(c,a){var b=$.data(c[0],"datagrid").options;return b.finder.getTr(c[0],a).find("span.datagrid-row-expander")},getRowDetail:function(d,a){var b=$.data(d[0],"datagrid").options;var c=b.finder.getTr(d[0],a,"body",2);return c.next().find("div.datagrid-row-detail")},expandRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.show();g.show();$(this).datagrid("fixDetailRowHeight",a);if(e.onExpandRow){var f=$(this).datagrid("getRows")[a];e.onExpandRow.call(this,a,f)}}})},collapseRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.hide();g.hide();d.body2.triggerHandler("scroll");if(e.onCollapseRow){var f=$(this).datagrid("getRows")[a];e.onCollapseRow.call(this,a,f)}}})}});