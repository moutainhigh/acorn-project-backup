function popWin(c,b,a){$("#"+b).remove();$("body").append($("#"+c,parent.document.body).contents().find("#"+b).clone(true));$("document").append($("#"+c,parent.document.body).contents().find("#"+b).clone(true));$("#"+b).window(a).window("open").window("move",{top:($(window).height()-$("#"+b).window("panel").height()-10)*0.5})}function alertWin(b,c){var a={title:b};$("#alertWin").html(c);$("#alertWin").window(a).window("open")}function closeWin(a){$("#"+a).window("close").window("destroy")}function resetApptabsWidth(){var a=$("#apptabs li").length-5;if(a>0){$("#apptabs").width(a*92+350)}}function subCallback(frameId,method){if(!typeof(frameId)=="undefined"||!method){return}if(frameId==""){var paramStr="";for(var i=2;i<arguments.length;i++){if(i>2){paramStr+=","}paramStr+='"'+arguments[i]+'"'}eval(method+"("+paramStr+")")}else{var child=window.frames[frameId];var paramStr="";for(var i=2;i<arguments.length;i++){if(i>2){paramStr+=","}paramStr+='"'+arguments[i]+'"'}if(frameId=="tab_CallbackTab"){eval("p_CallbackTab."+method+"("+paramStr+")")}else{if(child!=null){child.eval(method+"("+paramStr+")")}else{console.debug("null")}}}}function getSubString(b){var a=b;if(a.substring(0,1)=='"'){a=a.substring(1,a.length);a=a.substring(0,a.length-1)}return a}function subContactCallback(b,c){var a="p_"+b;subCallback(a,c)}function detectBrowser(){var a=-1;if($.browser.msie){a=1}if($.browser.mozilla){a=2}if($.browser.chrome){a=3}if($.browser.safari){a=4}if($.browser.opera){a=5}return a}function SetCwinHeight(b){var a=b;if(document.getElementById(a.id)){if(a&&!window.opera){if(a.contentDocument&&a.contentDocument.body.offsetHeight){a.height=a.contentDocument.body.offsetHeight}else{if(a.Document&&a.Document.body.scrollHeight){a.height=a.Document.body.scrollHeight}}}}setPageH(a)}function setPageH(a){$("#scrollWarp").width($(window).width()-448-$("#apptabs").width());setTimeout(function(){$("#center,#right").height("auto");if(a){var c=[parseInt(a.height)+25+33,$("#right").height()];var b=Math.max.apply(null,c);$("#left").height(b-10);$("#right").height(b);$("#center").height(b+5)}},100)}function toggleEv(){$("#fn-bg").bind("click",function(a){$("div.bpoint").toggleClass("on");a.stopPropagation()});$("body").bind("click",function(a){$("div.bpoint").removeClass("on")});$("div.bpoint").click(function(){return false})}var _callBackframeid="";var _callbackMethod="";var _source="";function queryC(b,a,c){_callBackframeid=b;_callbackMethod=a;_source=c;cancleAddressItem();$("#name").val("");$("#phone").val("");$("#findValue").val("");$("#defaultTable").datagrid("loadData",{total:0,rows:[]});$("#defaultTablem").datagrid("loadData",{total:0,rows:[]});if(c=="incomingCall"){$("#queryC").window({close:false})}$("#queryC").window({closable:true,left:($(window).width()-700)/2});$("#queryC").window("open",{type:"fade"})}function queryCustomer(d,b,e,c,a){_callBackframeid=d;_callbackMethod=b;_source=e;$("#name").val("");$("#phone").val("");$("#findValue").val("");$("#defaultTable").datagrid("loadData",{total:0,rows:[]});$("#defaultTablem").datagrid("loadData",{total:0,rows:[]});$("#phone").val(c);if(typeof(a)=="undefined"){$("#queryC").window({closable:false})}else{if(a){$("#queryC").window({closable:true})}else{$("#queryC").window({closable:false})}}$("#queryC").window("open");cancleAddressItem()}var tabsMap=null;var openedContact=new Array();var panelsMap=null;var currentTabObj=null;var currentPanelObj=null;var maxIndex=999;var startId=1;var showccBut=false;function initMain(){currentPanelObj=createPanel("home","false","/home/home");toggleEv();$("#center .tabPage").each(function(){$(this).click(function(){$("#apptabs a").removeClass("current");$("#tabs-active li").removeClass("current");$("#w_combox a").removeClass("sel");$(this).addClass("current");if(this.id=="home"){if(p_home){p_home.window.refreshCampaignGrid(1);p_home.window.refreshAuditGrid(1)}}var c=$(this).attr("id");var a=$(this).attr("url");var b=panelsMap.get(c);currentTabObj=null;if(b==null){closeCurrentPanel();currentPanelObj=createPanel(c,"false",a)}else{closeCurrentPanel();currentPanelObj=b;openCurrentPanel()}SetCwinHeight(currentPanelObj.dom)})})}function initLeftMenu(){$(".leftMenu").live("click",function(){var d=$(this).attr("id");var a=$(this).attr("name");var c=$(this).text();var b=$(this).attr("multiTab");addTab(d,c,b,a)})}function closeAllTabs(){if(tabsMap){var b=tabsMap.size();var c=tabsMap.list().slice(0);for(var a=0;a<b;a++){destoryTab(c[a].key)}}}function createPanel(c,a,b){setPageH();$("#appContent").append('<div><iframe id="p_'+c+'"  name="p_'+c+'" style="width:100%;height:10000px" allowTransparency="true" src='+b+'  frameborder="0"  class="" onload="javascript:SetCwinHeight(this);$(this).focus();"></iframe></div>');var d=new panelObject(c,true,null);panelsMap.put(c,d);return d}function addTab(d,f,a,c,e,b){showccBut=false;d=d+"";if(a=="true"){currentTabObj=newTab(d+"_"+(startId++),f,a,c,e,b)}else{if(tabsMap==null){tabsMap=new Map()}currentTabObj=tabsMap.get(d);if(currentTabObj==null){currentTabObj=newTab(d,f,a,c,e,b)}else{var g=panelsMap.get(d);if(g){closeCurrentPanel();currentPanelObj=g;openCurrentPanel()}}}changeTab($("#"+currentTabObj.tabId))}function newTab(tabId,tabName,isNew,url,showCallback,isCloseable){if(tabsMap==null){tabsMap=new Map()}var idx=maxIndex-tabsMap.list().length;$("#w_combox").append('<a for="tab_'+tabId+'">'+tabName+"</a>").parent().addClass("comOn").unbind().bind("click",function(){event.stopPropagation();$(this).addClass("ope");$("#w_combox").show()});$("body").click(function(){$("#w_combox").hide().parent().removeClass("ope")});$("#tabs-active").append('<li  id="tab_'+tabId+'" name='+tabId+' title="'+tabName+'" style="z-index:'+idx+'"><span  class="tab_content"><span>'+tabName+'</span></span><a  class="tab-closeBtn"><span  name="'+tabId+'" class="tab-closeBtn"></span></a></li>');if(typeof(isCloseable)!="undefined"){if(!isCloseable){$("#tab_"+tabId).addClass("rell");$('#w_combox a[for="tab_'+tabId+'"]').css({color:"#007896",textShadow:"rgba(255, 255, 255, 0.8) 0px 0 2px"});showccBut=true}}$("#tabs-active li").removeClass("current");closeCurrentPanel();currentPanelObj=createPanel(tabId,isNew,url);var tab=new panelObject(tabId,true,idx);tabsMap.put(tabId,tab);currentTabObj=tab;$("#tab_"+tabId).click(function(){tabsMap.end(tabId);changeTab($(this));var id=String($(this).attr("name"));var pObj=panelsMap.get(id);if(pObj){closeCurrentPanel();currentPanelObj=pObj;openCurrentPanel()}$("#apptabs a").removeClass("current");$("#tabs-active li").removeClass("current");$(this).addClass("current");SetCwinHeight(currentPanelObj.dom);if(showCallback!=null){var child=window.frames["p_"+tabId];child.eval(showCallback+"()")}});$("#w_combox a[for='tab_"+tabId+"']").click(function(){$("#w_combox a").removeClass("sel");$(this).addClass("sel");$("#tab_"+tabId).click()});$("#apptabs a").removeClass("current");$("#tab_"+tabId+" .tab-closeBtn").click(function(){var tabId=$(this).attr("name");if(tabId){destoryTab(tabId)}});var re=new RegExp("/contact/1/([0-9]*)");if(re.test(url)){openedContact.push(RegExp.$1)}return tab}function changeTab(h){$("#apptabs a,#tabs-active li").removeClass("current");$("#w_combox a").removeClass("sel");if(h!=null){h.addClass("current");$("#w_combox a[for='"+h.attr("id")+"']").addClass("sel")}var b=0;var g=Math.abs(parseInt($("#tabs-active").css("margin-left")));h.prevAll().each(function(){b+=$(this).width()+11});if(b<g){$("#tabs-active").css("margin-left","-"+b+"px")}else{if(g+$("#scrollWarp").width()<b+h.width()+27){$("#tabs-active").css("margin-left","-"+(b+h.width()+30-$("#scrollWarp").width())+"px")}}var f=$("#tabs-active li").length*85;var a=parseInt($("#tabs-active").css("margin-left"));var e=$("#scrollWarp").width();if(a<0&&f>-a+e){$("#l_scroll").addClass("l_on");$("#r_scroll").addClass("r_on")}else{if(a<0&&f<-a+e){$("#l_scroll").addClass("l_on");$("#r_scroll").removeClass("r_on")}else{if(a==0&&f>e){$("#l_scroll").removeClass("l_on");$("#r_scroll").addClass("r_on")}}}}function destoryTab(b){$("#tab_"+b).remove();$("#p_"+b).parent().remove();$("#w_combox a[for='tab_"+b+"']").remove();tabsMap.remove(b);panelsMap.remove(b);var a=tabsMap.last();if(currentTabObj!=null){if(a){$("#"+a.tabId).css("z-index",1000);currentTabObj=a;changeTab($("#"+currentTabObj.tabId));closeCurrentPanel();currentPanelObj=panelsMap.get(a.parentId);openCurrentPanel()}else{currentPanelObj=panelsMap.get("home");changeTab($("#home"));openCurrentPanel();if(p_home){p_home.window.refreshCampaignGrid(1);p_home.window.refreshAuditGrid(1)}try{if(p_mytask){p_mytask.window.refreshCampaignGrid(2);p_mytask.window.refreshAuditGrid(2)}}catch(c){console.info("===========")}$("#w_combox").parent().removeClass("comOn").unbind()}}if($.inArray(b,openedContact)!=-1){openedContact.splice($.inArray(b,openedContact),1)}}function panelObject(c,b,a){this.id="p_"+c;this.tabId="tab_"+c;this.parentId=c;this.status=b;this.idx=a;this.dom=document.getElementById(this.id)}function closeCurrentPanel(){if(currentPanelObj!=null){$("#"+currentPanelObj.id).parent().hide()}}function openCurrentPanel(){if(currentPanelObj!=null){$("#"+currentPanelObj.id).parent().show()}SetCwinHeight(currentPanelObj.dom)}function getParentDom(){return window.document}(function(a){a.fn.Scroll=function(b,o){if(!b){var b={}}var n=a("#"+b.left);var p=a("#"+b.right);var j=this.eq(0).find("ul:first");var i=a("#scrollWarp").width();var f=0;var d;var h;function g(){var l=0;j.find("li").each(function(m){l+=a(this).width()+12});d=l;f=parseInt(j.css("margin-left"));h=d-Math.abs(f);if(h-a("#scrollWarp").width()>0&&h-a("#scrollWarp").width()<88){j.animate({"margin-left":f-(h-a("#scrollWarp").width())-10},100,function(){k()})}else{if(h-a("#scrollWarp").width()>88){j.animate({"margin-left":f-85},100,function(){k()})}}}function e(){var l=0;j.find("li").each(function(m){l+=a(this).width()+27});d=l;f=parseInt(j.css("margin-left"));if(Math.abs(f)>0&&Math.abs(f)<88){j.animate({"margin-left":0},100,function(){k()})}else{if(Math.abs(f)>88){j.animate({"margin-left":f+85},100,function(){k()})}}}function c(){j.stop()}function k(){var q=a("#tabs-active li").length*83;var l=parseInt(a("#tabs-active").css("margin-left"));var m=a("#scrollWarp").width();if(l<0&&q>-l+m){a("#l_scroll").addClass("l_on");a("#r_scroll").addClass("r_on")}else{if(l<0&&q<-l+m){a("#l_scroll").addClass("l_on");a("#r_scroll").removeClass("r_on")}else{if(l==0&&q>m){a("#l_scroll").removeClass("l_on");a("#r_scroll").addClass("r_on")}}}}n.bind("click",e);p.bind("click",g)}})(jQuery);$(function(){$(".tabs-warp").capacityFixed();$("#scrollWarp").Scroll({left:"l_scroll",right:"r_scroll"});resetApptabsWidth();$("[aria='true']").focus(function(){$(this).addClass("text-focus")}).blur(function(){$(this).removeClass("text-focus")});$("#handlebarContainer").click(function(){$("#sidebarCell").toggleClass("sidebarCollapsed");window.frames[currentPanelObj.id]._handler()});$("#handlebarContainer2").click(function(){$("#sidebarCell2").toggleClass("sidebarCollapsed");var currentIframe=currentPanelObj.id;window.frames[currentIframe]._handler()});$("#leftPage a").click(function(){setTimeout(function(){SetCwinHeight(currentPanelObj.dom)},1000)});$("#myorder").click(function(){var pObj=panelsMap.get("myorder");if(pObj!=null){var child=window.frames.p_myorder;child.eval("refreshMyorderlist()")}})});function openSms(){addTab("smsTab","短信",false,ctx+"/sms/index")}function openReminder(){document.getElementById("myorder").click()}function openMessage(){addTab("messageTab","消息管理",false,ctx+"/message/index","refreshMessage")}function waitforIframeLoadAndCallback(tabId,funcName,data,count){var child=window.frames["p_"+tabId];if(child!=null){var func=null;try{func=child.eval(funcName)}catch(e){console.debug(e);if(count<5){setTimeout(function(){waitforIframeLoadAndCallback(tabId,funcName,data,count++)},1000)}return}if(func!=null){func(data);return true}}}function showTabAndCallFunc(tabId,funcName,data){var child=window.frames["p_"+tabId];if(child!=null){$('#apptabs a[id="'+tabId+'"]').click();var func=null;try{func=child.eval(funcName)}catch(e){console.debug(e);return false}if(func!=null){func(data);return true}}else{$('#apptabs a[id="'+tabId+'"]').click();setTimeout(function(){waitforIframeLoadAndCallback(tabId,funcName,data,0)},1000);return true}return false}(function(){var a=jQuery.ajax;jQuery.extend({ajax:function(c,b){if(typeof c==="object"){b=c;c=undefined}var d=b.success;b.success=function(f){if(f){if(f.sessionTimeout){console.info("esssionTimeOut..............................................");window.location.href="/login";return}else{try{d.apply(this,arguments)}catch(g){}}}else{try{d.apply(this,arguments)}catch(g){}}};a(c,b)}})})();function banBackSpace(h){var d=h||window.event;var g=d.target||d.srcElement;var c=g.type||g.getAttribute("type");var f=g.getAttribute("readonly");var i=g.getAttribute("enabled");f=(f==null)?false:f;i=(i==null)?true:i;var b=(d.keyCode==8&&(c=="password"||c=="text"||c=="textarea")&&(f==true||i!=true))?true:false;var a=(d.keyCode==8&&c!="password"&&c!="text"&&c!="textarea")?true:false;if(a){return false}if(b){return false}}document.onkeypress=banBackSpace;document.onkeydown=banBackSpace;function addTabClickCallback(tabId,showCallback){if(showCallback!=null){$("#tab_"+tabId).click(function(){var child=window.frames["p_"+tabId];if(child!=null){console.info("inner add call back func!!!");child.eval(showCallback+"()")}})}}function complain(){$("#complain").window("open")}function msgConfirm(c,b,a){$.messager.confirm(c,b,a)};