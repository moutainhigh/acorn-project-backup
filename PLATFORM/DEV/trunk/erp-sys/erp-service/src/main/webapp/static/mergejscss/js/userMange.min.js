$(document).ready(function(){$("#loginUsers-grid").datagrid({width:"90%",height:"540",showHeader:true,nowrap:false,striped:true,border:true,collapsible:false,fitColumns:true,scrollbarSize:-1,url:"/getAU4",frozenColumns:[[]],columns:[[{field:"uid",title:"用户",width:60},{field:"ip",title:"登录IP",width:60},{field:"lastTime",title:"最近登录时间",width:60},{field:"server",title:"服务器",width:60},{field:"operator",title:"操作",width:50,align:"center",formatter:function(b,c,a){return"<a class='link stop' title='登出' href=\"javascript:cullingUser('"+c.uid+"','"+c.server+"')\"></a><a class='link stop' title='重置密码' href=\"javascript:changePwd('"+c.uid+"','"+c.server+"')\"></a><a class='link stop' title='解锁' href=\"javascript:unlock('"+c.uid+"','"+c.server+"')\"></a>"}}]],remoteSort:false,singleSelect:false,checkOnSelect:false,selectOnCheck:false,pagination:true,pageSize:10,loadFilter:pagerFilter,queryParams:{uid:$("#uid").val(),service:$("#server").combobox("getValue"),ip:$("#ip").val()},onLoadSuccess:function(a){},onLoadError:function(){window.parent.alertWin("系统提示","加载用户Session信息失败!")}});$("#server").combobox({url:"/getAU3",valueField:"server",textField:"server"})});function cullingUser(a,c){var b=$(parent.document).find("#fn-bg");if(b){if(a!=b.html().trim().split("&")[0]){$.messager.confirm("系统提示","您确定要强制用户"+a+"登出?",function(d){if(d){$.ajax({type:"get",url:"/cullingUserFromServer",data:{name:a,server:c},async:false,dataType:"json",success:function(){findInfo()}})}})}else{$.messager.alert("系统提示","不能强制自己登出！")}}}function changePwd(a){if(a){}}function unlock(a){if(a){$.ajax({type:"get",url:"/security/releaseLock",data:{userId:a},async:false,dataType:"json",success:function(b){$.messager.alert("系统提示",b.msg)}})}}function pagerFilter(d){if(typeof d.length=="number"&&typeof d.splice=="function"){d={total:d.length,rows:d}}var e=$(this);var c=e.datagrid("options");var b=e.datagrid("getPager");b.pagination({onSelectPage:function(h,g){c.pageNumber=h;c.pageSize=g;b.pagination("refresh",{pageNumber:h,pageSize:g});e.datagrid("loadData",d)}});if(!d.originalRows){d.originalRows=(d.rows)}var f=(c.pageNumber-1)*parseInt(c.pageSize);var a=f+parseInt(c.pageSize);d.rows=(d.originalRows.slice(f,a));return d}function cullingSingleUser(){var a=$(parent.document).find("#fn-bg");var b=$("#cullingUserId").val();if(b==""){$.messager.alert("系统提示","用户Id不能为空！");return false}if(b!=a.html().trim().split("&")[0]){$.messager.confirm("系统提示","您确定要强制用户"+b+"登出?",function(c){if(c){$.ajax({type:"get",url:"/cullingUserAll",data:"name="+b,async:false,dataType:"json",success:function(d){if(typeof(d)=="undefined"){$.messager.alert("系统提示","强制退出失败！")}else{$("#cullingUserId").val("");$.messager.alert("系统提示","强制退出成功！")}findInfo()}})}})}else{$.messager.alert("系统提示","不能强制自己登出！")}}function findInfo(){$("#loginUsers-grid").datagrid("load",{uid:$("#uid").val(),service:$("#server").combobox("getValue"),ip:$("#ip").val()})};