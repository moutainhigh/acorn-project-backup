$().ready(function(){$("#recommend-button").click(function(){var a=$("#recommend-button").attr("instId");if(a){var c=$("input[name='item-recomment']:checked").map(function(){return $(this).val()}).get().join(",");var b=$("#recommend-button").attr("tollFreeNum");var d=$("#recommend-button").attr("campainId");$.ajax({type:"POST",url:"/product/recommend/submit",data:{instId:a,tollFreeNum:b,campainId:d,nccodes:c},beforeSend:function(){recommendMsg("","",true)},success:function(e){if(e.indexOf("失败")>-1){recommendMsg(e,"red",false)}else{recommendMsg(e,"blue",false)}},dataType:"text"})}else{recommendMsg("还没有创建任务","red",false)}})});function clearRecommendItems(){$("#recommend-container").empty()}function search(a){$("#tbKeyword").val(a);$("#tbKeyword").search()}function incomingCall(a){clearRecommendItems();$.post("/product/recommend/incoming",{campainId:phone.campainId,tollFreeNum:a},function(c){$("#recommend-title").text("("+c.name+")").attr("title",c.name).show();if($.isArray(c.details)){for(var b=0;b<c.details.length;b++){var d=c.details[b];if(d){appendRecommendItem($(d).attr("nccode"),$(d).attr("spellname"),true)}}}})}function outgoingCall(b,a){clearRecommendItems();$("#recommend-button").attr("instId",a);$("#recommend-button").attr("campainId",b);$("#recommend-button").attr("tollFreeNum","");$("#recommend-button").attr("sourceType","");$.get("/task/querySourceType",{instId:a},function(c){$("#recommend-button").attr("sourceType",c)});$.post("/product/recommend/outgoing",{campainId:b,instId:a},function(d){$("#recommend-title").text("("+d.name+")").attr("title",d.name).show();if($.isArray(d.details)){for(var c=0;c<d.details.length;c++){var e=d.details[c];if(e){appendRecommendItem($(e).attr("nccode"),$(e).attr("spellname"),true)}}}})}function appendRecommendItem(e,d,b){if(b){$("#recommend-container").append("<p id='recommend-custom-item'><input class='checkbox fl' onchange='return changeItem(this)' name='item-recomment' type='checkbox' value='"+e+"' /><a href =\"javascript:search('"+e+"');\" title='"+d+"'>"+d+"</a></p>")}else{var a=$("#recommend-button").attr("instId");if(a){var c=$("input[name='item-recomment']").map(function(){return $(this).val()}).get();if($.inArray(e,c)==-1){$("#recommend-container-item").remove();$("#recommend-container").append("<p id='recommend-container-item'><input class='checkbox fl' onchange='return changeItem(this)' name='item-recomment' type='checkbox' value='"+e+"' /><a href =\"javascript:search('"+e+"');\" title='"+d+"'>"+d+"</a></p>")}}}}function changeItem(b){$("#recommend-button").click();var a=$("#recommend-button").attr("instId");if(a){$(b).attr("disabled","disabled")}else{$(b).removeAttr("checked")}return a}function hasRecommendedItem(){if($("#recommend-button").attr("sourceType")=="5"){return true}var a=$("input[name='item-recomment']:checked").map(function(){return $(this).val()}).get();if(a&&a.length>0){return true}else{a=$("input[name='item-recomment']").map(function(){return $(this).val()}).get();if(a.length>1){return false}else{if(a.length==0){return true}else{if($("#recommend-container").has("#recommend-custom-item")){return true}}}return false}}function recommendMsg(c,a,b){if($.contains("#recommend-wrap","div.tips")){$("#recommend-wrap").show()}else{$("#recommend-wrap").append('<div class="tips" ></div>')}if(b){$("#recommend-container div.c_mask").html('<img src="static/images/loading.gif">')}else{$("#recommend-wrap div.tips").html("<span >"+c+"</span>")}$("#recommend-wrap div.tips").fadeOut(2000)}function showIncomingCall(){window.queryC(frameElement.id,"returnIncomingCall","incomingCall")}function returnIncomingCall(c,b,d,a){createRecommendTask(c,b,d,a)}function createRecommendTask(c,b,e,a,d){$("#recommend-button").attr("tollFreeNum",c);$("#recommend-button").attr("telephone",b);$("#recommend-button").attr("sourceType",$("#callback").attr("value")=="1"?"4":"0");$.post("/product/recommend/lead",{tollFreeNum:c,telephone:b,leadId:d,contactId:e,contactType:a,sourceType:$("#recommend-button").attr("sourceType"),cticonnid:phone.cticonnid,begindate:phone.ctisdt,acdgroup:phone.acdId,callback:$("#callback").attr("value")=="1",campainId:phone.campainId},function(f){f=$.isPlainObject(f)?f:$.parseJSON(f);if(f){if(f.errorMsg){window.parent.alertWin("系统提示",f.errorMsg)}else{phone.instId=f.instId;phone.leadId=f.leadId;phone.leadInterId=f.leadInterId;$("#recommend-button").attr("instId",f.instId)}}},"json")}function getRecommandTaskId(){return $("#recommend-button").attr("instId")}function createRecommendTaskCallback(b,a){$("#recommend-button").attr("tollFreeNum",phone.dnsi);$("#recommend-button").attr("telephone",phone.ani);$("#recommend-button").attr("sourceType",a=="1"?"4":"0");$.post("/product/recommend/lead",{tollFreeNum:phone.dnsi,telephone:phone.ani,leadId:phone.leadId,contactId:b,contactType:phone.customerType,sourceType:a=="1"?"4":"0",cticonnid:phone.cticonnid,begindate:phone.ctisdt,acdgroup:phone.acdId,callback:$("#callback").attr("value")=="1",campainId:phone.campainId},function(c){c=$.isPlainObject(c)?c:$.parseJSON(c);if(c){if(c.errorMsg){window.parent.alertWin("系统提示",c.errorMsg)}else{phone.instId=c.instId;phone.leadId=c.leadId;phone.leadInterId=c.leadInterId;$("#recommend-button").attr("instId",c.instId)}}},"json")};